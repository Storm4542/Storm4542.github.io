<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>Storm</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="前端 | WEB | VUE">
<meta property="og:type" content="website">
<meta property="og:title" content="Storm">
<meta property="og:url" content="https://storm4542.github.io/page/2/index.html">
<meta property="og:site_name" content="Storm">
<meta property="og:description" content="前端 | WEB | VUE">
<meta property="og:locale" content="zh-CN">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Storm">
<meta name="twitter:description" content="前端 | WEB | VUE">
  
    <link rel="alternative" href="/atom.xml" title="Storm" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  <link rel="stylesheet" href="/css/style.css">
  

</head></html>
<body>
  <div id="container">
    <div id="wrap">
      <div class="outer">
        <section id="main">
  
    <article id="post-如何在mpvue中使用第三方UI组件" class="article article-type-post" itemscope="" itemprop="blogPost">
  
  <div class="article-inner">
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/archives/599cc31e.html">如何在mpvue中使用第三方UI组件</a>
    </h1>
  

      </header>
    
    <div class="article-meta">
      <a href="/archives/599cc31e.html" class="article-date">
  <time datetime="2018-08-27T06:02:43.000Z" itemprop="datePublished">2018-08-27</time>
</a>
      
    </div>
    <div class="article-entry" itemprop="articleBody">
      
        <p>最近接触了小程序业务，了解到美团的 mpvue 也可以做小程序。</p>
<p>使用方式也很简单，和 vue 一样， 但是他会自动将 Vue 编译为 小程序 语言。</p>
<p>下面言归正传，介绍一下如何在 mpvue 中使用第三方组件。</p>
<ol>
<li><p>创建 mpvue </p>
<figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vue init mpvue/mpvue-quickstart my-app</span><br></pre></td></tr></table></figure>
</li>
</ol>
<ol start="2">
<li>以 ivew weapp UI 举例 ，进入其 github 地址，下载后将 dist 目录下的所有东西，拷贝到 my-app 下 static 的 ivew (自己创建) 目录。</li>
</ol>
<ol start="3">
<li><p>在需要使用的页面中创建 main.json。</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">"usingComponents"</span>: &#123;</span><br><span class="line">    <span class="attr">"i-card"</span>: <span class="string">"../../../static/iview/card/index"</span>,</span><br><span class="line">    <span class="attr">"i-button"</span>: <span class="string">"../../../static/iview/button/index"</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ol>
<ol start="4">
<li><p>接下来就可以在 index.vue 中使用该标签了。</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">i-card</span> <span class="attr">full</span> <span class="attr">title</span>=<span class="string">"卡片标题"</span> <span class="attr">extra</span>=<span class="string">"额外内容"</span> <span class="attr">thumb</span>=<span class="string">"https://i.loli.net/2017/08/21/599a521472424.jpg"</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">view</span> <span class="attr">slot</span>=<span class="string">"content"</span>&gt;</span>内容不错<span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">view</span> <span class="attr">slot</span>=<span class="string">"footer"</span>&gt;</span>尾部内容<span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">i-card</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">i-button</span> <span class="attr">type</span>=<span class="string">"success"</span>&gt;</span>按钮<span class="tag">&lt;/<span class="name">i-button</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
</ol>

      

      
        
    </div>
  </div>
  
</article>



  
    <article id="post-在 Vue Cli 3 中使用 px2rem" class="article article-type-post" itemscope="" itemprop="blogPost">
  
  <div class="article-inner">
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/archives/18e53f06.html">在 Vue Cli 3 中使用 px2rem</a>
    </h1>
  

      </header>
    
    <div class="article-meta">
      <a href="/archives/18e53f06.html" class="article-date">
  <time datetime="2018-08-25T07:16:43.000Z" itemprop="datePublished">2018-08-25</time>
</a>
      
    </div>
    <div class="article-entry" itemprop="articleBody">
      
        <h4 id="安装-postcss-px2rem"><a href="#安装-postcss-px2rem" class="headerlink" title="# 安装 postcss-px2rem"></a># 安装 postcss-px2rem</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yarn add postcss-px2rem</span><br></pre></td></tr></table></figure>
<h4 id="在-vue-config-js-中添加配置"><a href="#在-vue-config-js-中添加配置" class="headerlink" title="# 在 vue.config.js 中添加配置"></a># 在 vue.config.js 中添加配置</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> px2rem = <span class="built_in">require</span>(<span class="string">'postcss-px2rem'</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> postcss = px2rem(&#123;</span><br><span class="line">  remUnit: <span class="number">32</span> 	<span class="comment">//基准大小 baseSize，需要和rem.js中相同</span></span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  css: &#123;</span><br><span class="line">    loaderOptions: &#123;</span><br><span class="line">      postcss: &#123;</span><br><span class="line">        plugins: [</span><br><span class="line">          postcss</span><br><span class="line">        ]</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="添加-rem-js"><a href="#添加-rem-js" class="headerlink" title="# 添加 rem.js"></a># 添加 rem.js</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 基准大小</span></span><br><span class="line"><span class="keyword">const</span> baseSize = <span class="number">32</span></span><br><span class="line"><span class="comment">// 设置 rem 函数</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">setRem</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="comment">// 当前页面宽度相对于 750 宽的缩放比例，可根据自己需要修改。</span></span><br><span class="line">  <span class="keyword">const</span> scale = <span class="built_in">document</span>.documentElement.clientWidth / <span class="number">750</span></span><br><span class="line">  <span class="comment">// 设置页面根节点字体大小</span></span><br><span class="line">  <span class="built_in">document</span>.documentElement.style.fontSize = baseSize * <span class="built_in">Math</span>.min(scale, <span class="number">2</span>) + <span class="string">'px'</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 初始化</span></span><br><span class="line">setRem()</span><br><span class="line"><span class="comment">// 改变窗口大小时重新设置 rem</span></span><br><span class="line"><span class="built_in">window</span>.onresize = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  setRem()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="引入-rem-js"><a href="#引入-rem-js" class="headerlink" title="# 引入 rem.js"></a># 引入 rem.js</h4><ul>
<li><p>方法一：直接在 index.html 中写入语句</p>
</li>
<li><p>方法二：将 rem.js 放入 public 文件夹 ， 在 main.js 中添加以下语句</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">;(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">  <span class="keyword">var</span> rem = <span class="built_in">document</span>.createElement(<span class="string">'script'</span>);</span><br><span class="line">  rem.src = <span class="string">'./rem.js'</span>;</span><br><span class="line">  <span class="built_in">document</span>.body.appendChild(rem)</span><br><span class="line">&#125;)()</span><br></pre></td></tr></table></figure>
</li>
</ul>

      

      
        
    </div>
  </div>
  
</article>



  
    <article id="post-MVC" class="article article-type-post" itemscope="" itemprop="blogPost">
  
  <div class="article-inner">
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/archives/5983b51f.html">前端中的MVC</a>
    </h1>
  

      </header>
    
    <div class="article-meta">
      <a href="/archives/5983b51f.html" class="article-date">
  <time datetime="2018-08-24T09:16:35.000Z" itemprop="datePublished">2018-08-24</time>
</a>
      
    </div>
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="前端中的MVC"><a href="#前端中的MVC" class="headerlink" title="前端中的MVC"></a>前端中的MVC</h2><p><strong>需求:通过AJAX获取数据，展示一个图书的书名，数量，并且用户可以修改数量，并上传到服务器。</strong></p>
<p>###1.意大利面条写法</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"app"</span>&gt;</span> <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*因为没有后台，默认bookdata就是从服务器传来的数据，由fethDb获取，saveDb更新 */</span></span><br><span class="line"><span class="keyword">var</span> bookData = &#123;</span><br><span class="line">    <span class="string">"id"</span>: <span class="string">"1"</span>,</span><br><span class="line">    <span class="string">"name"</span>: <span class="string">"javascript高程"</span>,</span><br><span class="line">    <span class="string">"number"</span>: <span class="number">2</span> <span class="comment">//数量</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">fetchDb</span>(<span class="params"></span>) </span>&#123; <span class="comment">//获取数据</span></span><br><span class="line">    <span class="keyword">return</span> bookData;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">saveDb</span>(<span class="params"></span>) </span>&#123; <span class="comment">//更新数据</span></span><br><span class="line">    <span class="keyword">return</span> bookData;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*我们需要把内容放到HTML里，所以需要有个模板 */</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> template = <span class="string">`</span></span><br><span class="line"><span class="string">        书名&lt;span id="name"&gt;《__name__》&lt;/span&gt;</span></span><br><span class="line"><span class="string">        数量&lt;span id="number"&gt; __number__&lt;/span&gt;</span></span><br><span class="line"><span class="string">        &lt;div&gt;</span></span><br><span class="line"><span class="string">        &lt;button id="add"&gt;加一&lt;/button&gt;</span></span><br><span class="line"><span class="string">        &lt;button id="minus"&gt;减一&lt;/button&gt;</span></span><br><span class="line"><span class="string">        &lt;/div&gt;</span></span><br><span class="line"><span class="string">        `</span></span><br><span class="line"><span class="comment">/*将我们的数据，放入模板*/</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">showBook</span>(<span class="params">result</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">var</span> html = template.replace(<span class="string">'__name__'</span>, result.name).replace(<span class="string">'__number__'</span>, result.number);</span><br><span class="line">    $(<span class="string">'#app'</span>).html(html)</span><br><span class="line">&#125;</span><br><span class="line">showBook(fetchDb()) <span class="comment">//渲染模板</span></span><br><span class="line"><span class="comment">/*写加减数量的方法 */</span>     </span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">add</span>(<span class="params"></span>) </span>&#123; </span><br><span class="line">    bookData.number+=<span class="number">1</span> </span><br><span class="line">    <span class="keyword">var</span> newdata =  saveDb(); <span class="comment">//假设更新了，并从服务器获取了修改后的新数据</span></span><br><span class="line">    $(<span class="string">'#number'</span>).text( newdata.number)</span><br><span class="line">    </span><br><span class="line">&#125;</span><br><span class="line">$(<span class="string">'#add'</span>).on(<span class="string">'click'</span>,add)</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">minus</span>(<span class="params"></span>) </span>&#123; </span><br><span class="line">    bookData.number-=<span class="number">1</span></span><br><span class="line">    <span class="keyword">var</span> newdata =  saveDb();</span><br><span class="line">    $(<span class="string">'#number'</span>).text( newdata.number)</span><br><span class="line">    </span><br><span class="line">&#125;</span><br><span class="line">$(<span class="string">'#minus'</span>).on(<span class="string">'click'</span>,minus)</span><br></pre></td></tr></table></figure>
<p><em>这种代码写法叫做意大利面条式代码，表示代码长短不一，很杂乱，如果我想要读懂这段代码，必须从开头读起。</em></p>
<h2 id="2-MVC"><a href="#2-MVC" class="headerlink" title="2.MVC"></a>2.MVC</h2><p><strong>一些程序员想出了解决办法</strong></p>
<p>一些程序员通过自己的总结，发现这些代码总是可以分成三类：</p>
<ol>
<li>专门操作远程数据的代码（fetchDb 和 saveDb 等等）</li>
<li>专门呈现页面元素的代码（innerHTML 等等）</li>
<li>其他控制逻辑的代码（点击某按钮之后做啥的代码）</li>
</ol>
<p>为什么分成这三类呢？因为我们前端抄袭了后端的分类思想，后端代码也经常分为三类：</p>
<ol>
<li>专门操作 MySQL 数据库的代码</li>
<li>专门渲染 HTML 的代码</li>
<li>其他控制逻辑的代码（用户请求首页之后去读数据库，然后渲染 HTML 作为响应等等）</li>
</ol>
<p>这些思路经过慢慢的演化，最终被广大程序员完善为 MVC 思想。</p>
<ol>
<li>M 专门负责数据</li>
<li>V 专门负责表现</li>
<li>C 负责其他逻辑</li>
</ol>
<p>如果我们来反思一下，会发现这个分类是无懈可击的：</p>
<ol>
<li>每个网页都有数据</li>
<li>每个网页都有表现（具体为 HTML）</li>
<li>每个网页都有其他逻辑</li>
</ol>
<p>于是乎，MVC 成了经久不衰的设计模式（设计模式就是「套路」的意思）</p>
<p><strong>我们改写一下上面的代码</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*创建一个model层 负责存储数据、请求数据、更新数据*/</span></span><br><span class="line"><span class="comment">/*因为没有后台，默认bookdata就是从服务器传来的数据，由fethDb获取，saveDb更新 */</span></span><br><span class="line"><span class="keyword">let</span> model = &#123;</span><br><span class="line">    bookData: &#123;</span><br><span class="line">        <span class="string">"id"</span>: <span class="string">"1"</span>,</span><br><span class="line">        <span class="string">"name"</span>: <span class="string">"javascript高程"</span>,</span><br><span class="line">        <span class="string">"number"</span>: <span class="number">2</span> <span class="comment">//数量</span></span><br><span class="line">    &#125;,</span><br><span class="line">    fetchDb() &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.bookData;</span><br><span class="line">    &#125;,</span><br><span class="line">    saveDb() &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.bookData;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/*view层，渲染视图*/</span></span><br><span class="line"><span class="keyword">let</span> view = &#123;</span><br><span class="line">    el: <span class="string">'#app'</span>,</span><br><span class="line">    template : <span class="string">`</span></span><br><span class="line"><span class="string">    书名&lt;span id="name"&gt;《__name__》&lt;/span&gt;</span></span><br><span class="line"><span class="string">    数量&lt;span id="number"&gt; __number__&lt;/span&gt;</span></span><br><span class="line"><span class="string">    &lt;div&gt;</span></span><br><span class="line"><span class="string">    &lt;button id="add"&gt;加一&lt;/button&gt;</span></span><br><span class="line"><span class="string">    &lt;button id="minus"&gt;减一&lt;/button&gt;</span></span><br><span class="line"><span class="string">    &lt;/div&gt;</span></span><br><span class="line"><span class="string">    `</span>,</span><br><span class="line">    render(result) &#123; <span class="comment">//此处将showbook改名为render</span></span><br><span class="line">        <span class="keyword">var</span> html = <span class="keyword">this</span>.template.replace(<span class="string">'__name__'</span>, result.name).replace(<span class="string">'__number__'</span>, result.number);</span><br><span class="line">        $(<span class="string">'#app'</span>).html(html)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*控制器，负责调度 model 和 view */</span></span><br><span class="line"><span class="keyword">let</span> controller = &#123;</span><br><span class="line">    init(&#123;model,view&#125;)&#123;</span><br><span class="line">        <span class="keyword">this</span>.model = model</span><br><span class="line">        <span class="keyword">this</span>.view = view</span><br><span class="line">        <span class="keyword">this</span>.view.render(model.fetchDb()) <span class="comment">//渲染模板</span></span><br><span class="line">        <span class="keyword">this</span>.bindEvents()</span><br><span class="line">    &#125;,</span><br><span class="line">    events:[</span><br><span class="line">        &#123;<span class="attr">type</span>:<span class="string">'click'</span>,<span class="attr">selector</span>:<span class="string">'#add'</span>,<span class="attr">fn</span>:<span class="string">'add'</span>&#125;,</span><br><span class="line">        &#123;<span class="attr">type</span>:<span class="string">'click'</span>,<span class="attr">selector</span>:<span class="string">'#minus'</span>,<span class="attr">fn</span>:<span class="string">'minus'</span>&#125;,</span><br><span class="line">    ],</span><br><span class="line">    bindEvents()&#123;</span><br><span class="line">        <span class="keyword">this</span>.events.map(<span class="function">(<span class="params">e</span>)=&gt;</span>&#123;</span><br><span class="line">            $(<span class="keyword">this</span>.view.el).on(e.type,e.selector,<span class="keyword">this</span>[e.fn].bind(<span class="keyword">this</span>)) <span class="comment">//事件绑定 注意this需要使用外面的this</span></span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;,</span><br><span class="line">    add() &#123;</span><br><span class="line">        model.bookData.number += <span class="number">1</span></span><br><span class="line">        <span class="keyword">var</span> newdata = model.saveDb(); <span class="comment">//假设更新了，并从服务器获取了修改后的新数据</span></span><br><span class="line">        $(<span class="string">'#number'</span>).text(newdata.number)</span><br><span class="line"></span><br><span class="line">    &#125;,</span><br><span class="line">    minus() &#123;</span><br><span class="line">        model.bookData.number -= <span class="number">1</span></span><br><span class="line">        <span class="keyword">var</span> newdata = model.saveDb();</span><br><span class="line">        $(<span class="string">'#number'</span>).text(newdata.number)</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">controller.init(&#123;model,view&#125;)</span><br></pre></td></tr></table></figure>
<h2 id="3-模板代码-也就是类"><a href="#3-模板代码-也就是类" class="headerlink" title="3.模板代码(也就是类)"></a>3.模板代码(也就是类)</h2><p>一个页面或模块只需要 model view controller 三个对象<br>第二个页面就需要再来 model2 view2 controller2 三个对象<br>第三个页面就需要再来 model3 view3 controller3 三个对象<br>……<br>第N个页面就需要再来 modelN viewN controllerN 三个对象</p>
<p>你每次写一个 model 都要写很类似的代码<br>你每次写一个 view 都要写很类似的代码<br>你每次写一个 controller 都要写很类似的代码</p>
<p>为什么不利用模板代码（俗称面向对象）把重复的代码写到一个类呢（JS里面就是把「共有属性」放到原型里）</p>
<p>代码如下</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*创建一个model calss 负责存储数据、请求数据、更新数据*/</span></span><br><span class="line"><span class="comment">/*因为没有后台，默认bookdata就是从服务器传来的数据，由fethDb获取，saveDb更新 */</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Model</span></span>&#123;</span><br><span class="line">    <span class="keyword">constructor</span>(options)&#123;</span><br><span class="line">        <span class="keyword">this</span>.data = options.data || &#123;&#125;</span><br><span class="line">    &#125;</span><br><span class="line">    fetchDb()&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.data</span><br><span class="line">    &#125;</span><br><span class="line">    saveDb()&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.data</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> model = <span class="keyword">new</span> Model(&#123;</span><br><span class="line">    data: &#123;</span><br><span class="line">        <span class="string">"id"</span>: <span class="string">"1"</span>,</span><br><span class="line">        <span class="string">"name"</span>: <span class="string">"javascript高程"</span>,</span><br><span class="line">        <span class="string">"number"</span>: <span class="number">2</span> <span class="comment">//数量</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">/*view class，渲染视图*/</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">View</span></span>&#123;</span><br><span class="line">    <span class="keyword">constructor</span>(options)&#123;</span><br><span class="line">        <span class="keyword">this</span>.el = options.el</span><br><span class="line">        <span class="keyword">this</span>.template = options.template</span><br><span class="line">    &#125;</span><br><span class="line">    render(result)&#123;</span><br><span class="line">        <span class="keyword">var</span> html = <span class="keyword">this</span>.template.replace(<span class="string">'__name__'</span>, result.name).replace(<span class="string">'__number__'</span>, result.number);</span><br><span class="line">        $(<span class="keyword">this</span>.el).html(html)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> view = <span class="keyword">new</span> View(&#123;</span><br><span class="line">    el:<span class="string">'#app'</span>,</span><br><span class="line">    template:<span class="string">`</span></span><br><span class="line"><span class="string">    书名&lt;span id="name"&gt;《__name__》&lt;/span&gt;</span></span><br><span class="line"><span class="string">    数量&lt;span id="number"&gt; __number__&lt;/span&gt;</span></span><br><span class="line"><span class="string">    &lt;div&gt;</span></span><br><span class="line"><span class="string">    &lt;input type="text"&gt;</span></span><br><span class="line"><span class="string">    &lt;button id="add"&gt;加一&lt;/button&gt;</span></span><br><span class="line"><span class="string">    &lt;button id="minus"&gt;减一&lt;/button&gt;</span></span><br><span class="line"><span class="string">    &lt;/div&gt;</span></span><br><span class="line"><span class="string">    `</span>,</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">/*控制器 class，负责调度 model 和 view */</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Controller</span></span>&#123;</span><br><span class="line">    <span class="keyword">constructor</span>(&#123;view ,model , events , init , ...rest&#125;)&#123;</span><br><span class="line">        <span class="keyword">this</span>.view = view</span><br><span class="line">        <span class="keyword">this</span>.model = model</span><br><span class="line">        <span class="keyword">this</span>.events = events</span><br><span class="line">        <span class="built_in">Object</span>.assign(<span class="keyword">this</span>,rest)</span><br><span class="line">        <span class="keyword">this</span>.bindEvents()</span><br><span class="line">        <span class="comment">//this.view.render(this.model.fetchDb())</span></span><br><span class="line">        init.apply()</span><br><span class="line">    &#125;</span><br><span class="line">    bindEvents()&#123;</span><br><span class="line">        <span class="keyword">this</span>.events.map(<span class="function">(<span class="params">e</span>)=&gt;</span>&#123;</span><br><span class="line">            $(<span class="keyword">this</span>.view.el).on(e.type,e.selector,<span class="keyword">this</span>[e.fn].bind(<span class="keyword">this</span>)) <span class="comment">//事件绑定 注意this需要使用外面的this</span></span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> controller = <span class="keyword">new</span> Controller(&#123;</span><br><span class="line">    view : view,</span><br><span class="line">    model : model,</span><br><span class="line">    events:[</span><br><span class="line">        &#123;<span class="attr">type</span>:<span class="string">'click'</span>,<span class="attr">selector</span>:<span class="string">'#add'</span>,<span class="attr">fn</span>:<span class="string">'add'</span>&#125;,</span><br><span class="line">        &#123;<span class="attr">type</span>:<span class="string">'click'</span>,<span class="attr">selector</span>:<span class="string">'#minus'</span>,<span class="attr">fn</span>:<span class="string">'minus'</span>&#125;,</span><br><span class="line">    ],</span><br><span class="line">    init()&#123;</span><br><span class="line">        <span class="keyword">this</span>.view.render(<span class="keyword">this</span>.model.fetchDb());</span><br><span class="line">    &#125;,</span><br><span class="line">    add() &#123;</span><br><span class="line">        <span class="keyword">this</span>.model.data.number += <span class="number">1</span></span><br><span class="line">        <span class="keyword">var</span> newdata = <span class="keyword">this</span>.model.saveDb(); <span class="comment">//假设更新了，并从服务器获取了修改后的新数据</span></span><br><span class="line">        <span class="keyword">this</span>.view.render(<span class="keyword">this</span>.model.saveDb());</span><br><span class="line"></span><br><span class="line">    &#125;,</span><br><span class="line">    minus() &#123;</span><br><span class="line">        <span class="keyword">this</span>.model.data.number -= <span class="number">1</span></span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">this</span>.model.data.number &lt;<span class="number">0</span>)&#123;</span><br><span class="line">            <span class="keyword">this</span>.model.data.number = <span class="number">0</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">var</span> newdata = <span class="keyword">this</span>.model.saveDb();</span><br><span class="line">        <span class="keyword">this</span>.view.render(<span class="keyword">this</span>.model.saveDb());</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p><strong>这么写，有一个bug ，每次更新数据，我们都要用 innerHtml 替换 #app里的东西，里面如果有 input 标签，用户的数据就无法保存</strong></p>
<h2 id="4-Vue的双向绑定"><a href="#4-Vue的双向绑定" class="headerlink" title="4.Vue的双向绑定"></a>4.Vue的双向绑定</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*创建一个model calss 负责存储数据、请求数据、更新数据*/</span></span><br><span class="line"><span class="comment">/*因为没有后台，默认bookdata就是从服务器传来的数据，由fethDb获取，saveDb更新 */</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Model</span> </span>&#123;</span><br><span class="line">    <span class="keyword">constructor</span>(options) &#123;</span><br><span class="line">        <span class="keyword">this</span>.data = options.data || &#123;&#125;</span><br><span class="line">    &#125;</span><br><span class="line">    fetchDb() &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.data</span><br><span class="line">    &#125;</span><br><span class="line">    saveDb() &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.data</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> model = <span class="keyword">new</span> Model(&#123;</span><br><span class="line">    data: &#123;</span><br><span class="line">        <span class="string">"id"</span>: <span class="string">"1"</span>,</span><br><span class="line">        <span class="string">"name"</span>: <span class="string">"javascript高程"</span>,</span><br><span class="line">        <span class="string">"number"</span>: <span class="number">2</span> <span class="comment">//数量</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">/*把 View 换成 VUE*/</span></span><br><span class="line"><span class="keyword">var</span> view = <span class="keyword">new</span> Vue(&#123;</span><br><span class="line">    el: <span class="string">'#app'</span>,</span><br><span class="line">    data: &#123;</span><br><span class="line">        book: &#123;</span><br><span class="line">            id:<span class="literal">null</span>,</span><br><span class="line">            name: <span class="string">'未命名'</span>,</span><br><span class="line">            number: <span class="number">0</span>,</span><br><span class="line">        &#125;,</span><br><span class="line">        n: <span class="number">100</span></span><br><span class="line"></span><br><span class="line">    &#125;,</span><br><span class="line">    template: <span class="string">`</span></span><br><span class="line"><span class="string">    &lt;div&gt;</span></span><br><span class="line"><span class="string">    书名&lt;span id="name" &gt;&#123;&#123; book.name &#125;&#125;&lt;/span&gt;</span></span><br><span class="line"><span class="string">    数量&lt;span id="number" &gt; &#123;&#123;book.number&#125;&#125;&lt;/span&gt;</span></span><br><span class="line"><span class="string">    &lt;div&gt;</span></span><br><span class="line"><span class="string">    &lt;input type="text" v-model = 'n'&gt;</span></span><br><span class="line"><span class="string">    &lt;button id="add" v-on:click = 'add'&gt;加一&lt;/button&gt;</span></span><br><span class="line"><span class="string">    &lt;button id="minus" v-on:click = 'minus'&gt;减一&lt;/button&gt;</span></span><br><span class="line"><span class="string">    &lt;/div&gt;</span></span><br><span class="line"><span class="string">    &lt;/div&gt;</span></span><br><span class="line"><span class="string">    `</span>,</span><br><span class="line">    created() &#123;</span><br><span class="line">        </span><br><span class="line">        view.book= model.fetchDb()</span><br><span class="line">       </span><br><span class="line">    &#125;,</span><br><span class="line">    methods: &#123;</span><br><span class="line">        add() &#123;</span><br><span class="line">            model.data.number += <span class="number">1</span></span><br><span class="line">            <span class="built_in">console</span>.log(model.saveDb().number)</span><br><span class="line">            <span class="keyword">this</span>.book.number = model.saveDb().number; <span class="comment">//假设更新了，并从服务器获取了修改后的新数据</span></span><br><span class="line"></span><br><span class="line">        &#125;,</span><br><span class="line">        minus() &#123;</span><br><span class="line">            model.data.number -= <span class="number">1</span></span><br><span class="line">            <span class="keyword">if</span> (model.data.number &lt; <span class="number">0</span>) &#123;</span><br><span class="line">                model.data.number = <span class="number">0</span></span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">this</span>.book.number = model.saveDb().number;</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>Vue 代替了 View，这就是 Vue 的名字和其读音的来历。</p>
<p>Vue 的双向绑定（也是 Angular 的双向绑定）有这些功能：</p>
<ol>
<li>只要 JS 改变了 view.number 或 view.name 或 view.n （注意 Vue 把 data 里面的 number、name 和 n 放到了 view 上面，没有 view.data 这个东西）， HTML 就会局部更新</li>
<li>只要用户在 input 里输入了值，JS 里的 view.n 就会更新。</li>
</ol>
<p>这就像双向绑定：JS 数据与页面元素互相绑定。</p>
<h3 id="Vue的双向绑定原理"><a href="#Vue的双向绑定原理" class="headerlink" title="Vue的双向绑定原理"></a>Vue的双向绑定原理</h3><p>使用了getter setter，缺点是无法监听不存在的属性</p>
<p>原理：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> data = &#123;<span class="attr">name</span>:<span class="string">'aaa'</span>&#125;</span><br><span class="line"><span class="keyword">var</span> _name = <span class="string">'zty'</span></span><br><span class="line"><span class="built_in">Object</span>.defineProperty(data,<span class="string">'name'</span>,&#123;</span><br><span class="line">  get()&#123;<span class="keyword">return</span> _name&#125;</span><br><span class="line">  set(value)&#123; _name = value ; <span class="built_in">console</span>.log(<span class="string">'更新了name'</span>)&#125; <span class="comment">//在这里做一个拦截，我们就可以知道用户修改了某个值，比如说input</span></span><br><span class="line">&#125;)</span><br><span class="line"><span class="built_in">console</span>.log(data.name)</span><br></pre></td></tr></table></figure>
<p>但是假如之前没有在 <code>data</code>里声明，，vue就无法监听了</p>
<p>强制监听</p>
<p><code>vm.$set()</code></p>
<p>向响应式对象中添加一个属性，并确保这个新属性同样是响应式的，且触发视图更新。它必须用于向响应式对象上添加新属性，因为 Vue 无法探测普通的新增属性 (比如 <code>this.myObject.newProperty = &#39;hi&#39;</code>)</p>
<p><a href="https://cn.vuejs.org/v2/api/#vm-set" rel="external nofollow noopener noreferrer" target="_blank">vm-set</a></p>
<h3 id="模拟上面的set-和-get"><a href="#模拟上面的set-和-get" class="headerlink" title="模拟上面的set 和 get"></a>模拟上面的set 和 get</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">X</span></span>&#123;</span><br><span class="line">    <span class="keyword">constructor</span>(&#123;data&#125;)&#123;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">let</span> key <span class="keyword">in</span> data)&#123;</span><br><span class="line">            <span class="built_in">Object</span>.defineProperty(<span class="keyword">this</span>, key, &#123;</span><br><span class="line">                get ()&#123;</span><br><span class="line">                    <span class="keyword">return</span> data[key]</span><br><span class="line">                &#125;,</span><br><span class="line">                set (value)&#123;</span><br><span class="line">                    <span class="built_in">console</span>.log(<span class="string">'有人修改了'</span> + key)</span><br><span class="line">                    data[key] = value</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> view = <span class="keyword">new</span> X(&#123;</span><br><span class="line">    data: &#123;</span><br><span class="line">        name: <span class="string">'frank'</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(view.name === <span class="string">'frank'</span>) <span class="comment">// 输出 true</span></span><br><span class="line">view.name = <span class="string">'jack'</span> <span class="comment">// 输出「有人修改了 name」</span></span><br></pre></td></tr></table></figure>

      

      
        
    </div>
  </div>
  
</article>



  
    <article id="post-关于函数" class="article article-type-post" itemscope="" itemprop="blogPost">
  
  <div class="article-inner">
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/archives/4cf7e60f.html">JavaScript里的函数是什么</a>
    </h1>
  

      </header>
    
    <div class="article-meta">
      <a href="/archives/4cf7e60f.html" class="article-date">
  <time datetime="2018-08-24T09:16:35.000Z" itemprop="datePublished">2018-08-24</time>
</a>
      
    </div>
    <div class="article-entry" itemprop="articleBody">
      
        <h3 id="1-定义"><a href="#1-定义" class="headerlink" title="1.定义"></a>1.定义</h3><pre><code>i 匿名函数
</code></pre><p>​    <code>var fn = function(){return 1} 有name fn.name = &#39;fn&#39;</code></p>
<p>​    ii 具名函数</p>
<p>​    <code>function fn(){ return 1}</code></p>
<p>​    <code>var fn2 = function fn3(){ return 2 }</code></p>
<p>​     两者的区别在于函数作用域</p>
<p>​    <code>console.log(fn()) fn()</code>  </p>
<p>​    <code>console.log(fn3()) undefined</code></p>
<p>​    iii 箭头函数</p>
<p>​    <code>var fn = (i,j)=&gt;{return i+j}</code> fn.name = fn</p>
<p>###2.词法作用域（静态作用域）</p>
<pre><code>  var global1 = 1

     function fn1(param1){

       var local1 = &apos;local1&apos;
       var local2 = &apos;local2&apos;)
       function fn2(param2){
           var local2 = &apos;inner local2&apos;
           console.log(local1)
           console.log(local2)
       }

     function fn3(){
         var local2 = &apos;fn3 local2&apos;
         fn2(local2)
     }
   }


var i = 1,j = 2,k = 3;

function a(o,p,x,q){

var x = 4;
    alert(i+&apos;a&apos;);
function b(r,s) {
    var i = 11,y = 5;
        alert(i+ &apos;b&apos;);
    function c(t){
      var z = 6;
            alert(i+&apos;c&apos;);
    };
        //函数表达式
    var d = function(){
            alert(y+&apos;y d&apos;);
        };
        c(60);
        d();
};
    b(40,50);
    }

a(10,20,30);
</code></pre><p> 通过画出词法树分析。先找同级有没有，再找上级的。</p>
<p><a href="https://xiedaimala.com/tasks/f3b7885d-ac51-4c41-a498-d01d532cc651?learnable_type=VideoTutorial&amp;learnable_id=76247167-7764-4c49-bf78-53b4d126da7a#/" rel="external nofollow noopener noreferrer" target="_blank">方方的视频</a></p>
<p><a href="http://js8.in/2011/08/15/javascript%E7%9A%84%E8%AF%8D%E6%B3%95%E4%BD%9C%E7%94%A8%E5%9F%9F/" rel="external nofollow noopener noreferrer" target="_blank">参考</a></p>
<p>###3.call stack</p>
<p>​    i stack</p>
<p>​    栈，先进后出，后进先出。</p>
<blockquote>
<p><a href="http://latentflip.com/loupe/?code=ZnVuY3Rpb24gYSgpewogICAgY29uc29sZS5sb2coJ2EnKQogIHJldHVybiAnYScgIAp9CgpmdW5jdGlvbiBiKCl7CiAgICBjb25zb2xlLmxvZygnYicpCiAgICByZXR1cm4gJ2InCn0KCmZ1bmN0aW9uIGMoKXsKICAgIGNvbnNvbGUubG9nKCdjJykKICAgIHJldHVybiAnYycKfQoKYSgpCmIoKQpjKCk%3D!!!" rel="external nofollow noopener noreferrer" target="_blank">1+1+1</a></p>
<p><a href="http://latentflip.com/loupe/?code=ZnVuY3Rpb24gYSgpewogICAgY29uc29sZS5sb2coJ2ExJykKICAgIGIoKQogICAgY29uc29sZS5sb2coJ2EyJykKICByZXR1cm4gJ2EnICAKfQpmdW5jdGlvbiBiKCl7CiAgICBjb25zb2xlLmxvZygnYjEnKQogICAgYygpCiAgICBjb25zb2xlLmxvZygnYjInKQogICAgcmV0dXJuICdiJwp9CmZ1bmN0aW9uIGMoKXsKICAgIGNvbnNvbGUubG9nKCdjJykKICAgIHJldHVybiAnYycKfQphKCkKY29uc29sZS5sb2coJ2VuZCcp!!!" rel="external nofollow noopener noreferrer" target="_blank">1+2+3</a></p>
<p><a href="ZnVuY3Rpb24gZmFiKG4pewogICAgY29uc29sZS5sb2coJ3N0YXJ0IGNhbGMgZmFiICcrIG4pCiAgICBpZihuPj0zKXsKICAgICAgICByZXR1cm4gZmFiKG4tMSkgKyBmYWIobi0yKQogICAgfWVsc2V7CiAgICAgICAgcmV0dXJuIDEKICAgIH0KfQoKZmFiKDUp">递归</a></p>
<blockquote>
<p>斐波那契数列</p>
<p>function fb(n){</p>
<p>console.log(‘我正在计算’+ n );</p>
<p>if( n&gt;=3 ){</p>
<p>return fb(n-1) + fb(n-2)</p>
<p>}else{</p>
<p>return 1;</p>
<p>}</p>
<p>}</p>
</blockquote>
</blockquote>
<h3 id="4-this-amp-amp-arguments"><a href="#4-this-amp-amp-arguments" class="headerlink" title="4.this &amp;&amp; arguments"></a>4.this &amp;&amp; arguments</h3><ul>
<li><p>this 是隐藏的第一个参数，而且必须是对象。</p>
<ul>
<li><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">f</span>(<span class="params"></span>)</span>&#123;<span class="built_in">console</span>.log(<span class="keyword">this</span>); <span class="built_in">console</span>.log(<span class="built_in">arguments</span>)&#125;</span><br><span class="line">f.call() <span class="comment">// window []</span></span><br><span class="line">f.call(&#123;<span class="attr">name</span>:<span class="string">'zty'</span>&#125;) <span class="comment">// &#123;name:'zty'&#125; []</span></span><br><span class="line">f.call(&#123;<span class="attr">name</span>:<span class="string">'zty'</span>&#125;,<span class="number">1</span>,<span class="number">2</span>) <span class="comment">// &#123;name:'zty&#125; [1,2]</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>调用一个函数，开始需要三部</p>
<ul>
<li><p>记录函数的位置，放入 call stack</p>
</li>
<li><p>传入 this 对象</p>
</li>
<li><p>传入 arguments 数组(伪)</p>
</li>
</ul>
</li>
<li><p>为什么要用 call</p>
<ul>
<li>fn() 是 fn.call() 的阉割版</li>
</ul>
</li>
</ul>
</li>
<li><p>为什么 this 必须是对象</p>
<ul>
<li><p>因为 this 就是函数与对象之间的羁绊</p>
</li>
<li><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> person = &#123;</span><br><span class="line">  name : <span class="string">'zty'</span>,</span><br><span class="line">  sayHi : <span class="function"><span class="keyword">function</span>(<span class="params">person</span>)</span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(person.name ,<span class="string">'HI'</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">person.sayHi(person) <span class="comment">// zty HI 这种方式很蠢，前面有 person 后面有 person, 为什么 JS 不能帮我把 参数中的person 指定了呢，于是改造一下</span></span><br><span class="line"><span class="keyword">var</span> person = &#123;</span><br><span class="line">  name : <span class="string">'zty'</span>,</span><br><span class="line">  sayHi : <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="keyword">this</span>.name ,<span class="string">'HI'</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">person.sayHi.call(person) <span class="comment">// zty HI 不吃语法糖 this === person ，指定this</span></span><br><span class="line">person.sayHi() <span class="comment">// 吃语法糖</span></span><br><span class="line">person.sayHi.call(&#123;<span class="attr">name</span>:<span class="string">'xxx'</span>&#125;) <span class="comment">// xxx HI 说明里面的函数其实跟person对象没有任何关系，是独立的。(this 真的很不靠谱)</span></span><br><span class="line">------------------------------</span><br><span class="line"><span class="keyword">var</span> fn = person.sayHi;</span><br><span class="line">fn() <span class="comment">// HI 显示不出 'zty',这是因为fn()其实是 fn.call() =&gt; this为window</span></span><br><span class="line">fn(person) <span class="comment">// HI this === window</span></span><br><span class="line">fn.call(person) <span class="comment">// zty HI this === persom</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
</ul>
<h3 id="5-call-aplly"><a href="#5-call-aplly" class="headerlink" title="5.call/aplly"></a>5.call/aplly</h3><p>​    i call 用是函数调用标准写法，传递this , xxx.call(ASthis , arguments)</p>
<p>​    ii  当你不确定参数的个数时候(数组)，使用apply , xxx.apply(ASthis , [ … ])</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">sum</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> n = <span class="number">0</span> ;</span><br><span class="line">  <span class="keyword">for</span>(<span class="keyword">var</span> i = <span class="number">0</span> ; i&lt;<span class="built_in">arguments</span>.length ; i++)&#123;</span><br><span class="line">    n+=<span class="built_in">arguments</span>[i]</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> n ;</span><br><span class="line">&#125; <span class="comment">// 无论有多少参数都可以求和的函数</span></span><br><span class="line">sum.call(<span class="literal">undefined</span> , <span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>)   <span class="comment">// 6</span></span><br><span class="line">sum.call(<span class="literal">undefined</span> , <span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>) <span class="comment">// 10</span></span><br><span class="line"><span class="comment">//假如你不知道有多少参数呢？传给你一个数组 a , 并不知道里面的内容，如何求和？</span></span><br><span class="line"><span class="comment">//或者 a.length === 100 ，你如何传参呢？</span></span><br><span class="line">sum.apply(<span class="literal">undefined</span> , a);</span><br></pre></td></tr></table></figure>
<h3 id="6-bind"><a href="#6-bind" class="headerlink" title="6.bind"></a>6.bind</h3><p>​    call 和 apply 都是直接调用函数，而 bind 是返回一个新的函数 ， 这个新函数会call 原来的参数 ，call 的参数由你指定。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> view = &#123;</span><br><span class="line">  element : <span class="string">'#div'</span>,</span><br><span class="line">  bindEvents : <span class="function"><span class="keyword">function</span> (<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">this</span>.element.onClick = <span class="keyword">this</span>.onClick.bind(<span class="keyword">this</span>)</span><br><span class="line">    <span class="comment">//view.element.onClick = view.onClick.bind(view)</span></span><br><span class="line">    <span class="comment">//this.onClick.bind(this) bind的参数this ，会变成 onClick 的第一个参数</span></span><br><span class="line">    <span class="comment">//为什么这么做？因为 onClick 的 this ， 是被点击元素，我们需要的 this === view</span></span><br><span class="line">  &#125;</span><br><span class="line">    onClick: <span class="function"><span class="keyword">function</span> (<span class="params"></span>)</span>&#123;</span><br><span class="line">      <span class="keyword">this</span>.element.addClass(<span class="string">'active'</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="7-回调-callback"><a href="#7-回调-callback" class="headerlink" title="7.回调 callback"></a>7.回调 callback</h3><p>​    i 名词形式 ： 被当做参数的函数 <code>array.sort(function(a,b){return a-b})</code></p>
<p>​    ii 动词形式 ： 调用这个回调</p>
<p>​    回调跟异步没有一点关系</p>
<h3 id="8-构造函数"><a href="#8-构造函数" class="headerlink" title="8.构造函数"></a>8.构造函数</h3><p>​    i 返回对象的函数就是构造函数  <code>new Number(1)</code></p>
<p>​    ii 一般首字母大写。</p>
<h3 id="9-箭头函数"><a href="#9-箭头函数" class="headerlink" title="9.箭头函数"></a>9.箭头函数</h3><p>​    i 箭头函数没有 this </p>
<p>​    ii 有 arguments </p>

      

      
        
    </div>
  </div>
  
</article>



  
    <article id="post-制作一个vue的tabs轮子" class="article article-type-post" itemscope="" itemprop="blogPost">
  
  <div class="article-inner">
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/archives/88d55ab5.html">制作一个基于Vue的Tabs轮子</a>
    </h1>
  

      </header>
    
    <div class="article-meta">
      <a href="/archives/88d55ab5.html" class="article-date">
  <time datetime="2018-08-24T09:16:35.000Z" itemprop="datePublished">2018-08-24</time>
</a>
      
    </div>
    <div class="article-entry" itemprop="articleBody">
      
        <h3 id="tabs轮子制作"><a href="#tabs轮子制作" class="headerlink" title="tabs轮子制作"></a>tabs轮子制作</h3><h4 id="1-先简单实现一下"><a href="#1-先简单实现一下" class="headerlink" title="1.先简单实现一下"></a>1.先简单实现一下</h4><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">'app'</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.active</span>&#123;<span class="attribute">background</span>:red&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> vm = <span class="keyword">new</span> Vue(&#123;</span><br><span class="line">    el: <span class="string">'#app'</span>,</span><br><span class="line">    data() &#123;</span><br><span class="line">        <span class="keyword">return</span> &#123;</span><br><span class="line">            selectedTab: <span class="number">1</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    template: <span class="string">`</span></span><br><span class="line"><span class="string">       &lt;div class="tabs"&gt;</span></span><br><span class="line"><span class="string">            &lt;ol class="nav"&gt;</span></span><br><span class="line"><span class="string">                &lt;li @click = 'selectedTab = 1' :class ='&#123; active: selectedTab === 1 &#125;'  &gt;tab1&lt;/li&gt;</span></span><br><span class="line"><span class="string">                &lt;li @click = 'selectedTab = 2' :class ='&#123; active: selectedTab === 2 &#125;' &gt;tab2&lt;/li&gt;</span></span><br><span class="line"><span class="string">            &lt;/ol&gt;</span></span><br><span class="line"><span class="string">            &lt;ol class="panels"&gt;</span></span><br><span class="line"><span class="string">                &lt;li :class = '&#123;active : selectedTab === 1&#125;' &gt;content1&lt;/li&gt;</span></span><br><span class="line"><span class="string">                &lt;li :class = '&#123; active: selectedTab === 2 &#125;' &gt;content2 &lt;/li&gt;</span></span><br><span class="line"><span class="string">            &lt;/ol&gt;</span></span><br><span class="line"><span class="string">        &lt;/div&gt;</span></span><br><span class="line"><span class="string">    `</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>很简单，但是没有复用性。</p>
<h4 id="2-轮子的实现"><a href="#2-轮子的实现" class="headerlink" title="2.轮子的实现"></a>2.轮子的实现</h4><ul>
<li><p>思路：用户如何使用我这个组件呢？</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> vm = <span class="keyword">new</span> Vue(&#123;</span><br><span class="line">    el: <span class="string">'#app'</span>,</span><br><span class="line">    data() &#123;</span><br><span class="line">        <span class="keyword">return</span> &#123;</span><br><span class="line">            selectedTab: <span class="number">1</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    template: <span class="string">`</span></span><br><span class="line"><span class="string">    &lt;tabs&gt;</span></span><br><span class="line"><span class="string">        &lt;tabs-navs&gt;</span></span><br><span class="line"><span class="string">            &lt;tabs-navs-item&gt;1&lt;/tabs-navs-item&gt;</span></span><br><span class="line"><span class="string">            &lt;tabs-navs-item&gt;2&lt;/tabs-navs-item&gt;</span></span><br><span class="line"><span class="string">        &lt;/tabs-navs&gt;</span></span><br><span class="line"><span class="string">        &lt;tabs-panels&gt;</span></span><br><span class="line"><span class="string">            &lt;tabs-panels-item&gt;content 1&lt;/tabs-panels-item&gt;</span></span><br><span class="line"><span class="string">            &lt;tabs-panels-item&gt;content 2&lt;/tabs-panels-item&gt;</span></span><br><span class="line"><span class="string">        &lt;/tabs-panels&gt;</span></span><br><span class="line"><span class="string">    &lt;/tabs&gt;</span></span><br><span class="line"><span class="string">    `</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>差不多这样调用，其他的不用管，一个tabs就出来了</p>
</li>
<li><p>开始写，我先声明这些tabs的组件</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">Vue.component(<span class="string">'tabs'</span>,&#123;&#125;)</span><br><span class="line">Vue.component(<span class="string">'tans-navs'</span>,&#123;&#125;)</span><br><span class="line">Vue.component(<span class="string">'tabs-navs-item'</span>,&#123;&#125;)</span><br><span class="line">Vue.component(<span class="string">'tans-panels'</span>,&#123;&#125;)</span><br><span class="line">Vue.component(<span class="string">'tabs-panels-item'</span>,&#123;&#125;)</span><br><span class="line"><span class="keyword">var</span> vm = <span class="keyword">new</span> Vue(&#123;</span><br><span class="line">    el: <span class="string">'#app'</span>,</span><br><span class="line">    data() &#123;</span><br><span class="line">        <span class="keyword">return</span> &#123;</span><br><span class="line">            selectedTab: <span class="number">1</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    template: <span class="string">`</span></span><br><span class="line"><span class="string">    &lt;tabs&gt;</span></span><br><span class="line"><span class="string">        &lt;tabs-navs&gt;</span></span><br><span class="line"><span class="string">            &lt;tabs-navs-item&gt;1&lt;/tabs-navs-item&gt;</span></span><br><span class="line"><span class="string">            &lt;tabs-navs-item&gt;2&lt;/tabs-navs-item&gt;</span></span><br><span class="line"><span class="string">        &lt;/tabs-navs&gt;</span></span><br><span class="line"><span class="string">        &lt;tabs-panels&gt;</span></span><br><span class="line"><span class="string">            &lt;tabs-panels-item&gt;content 1&lt;/tabs-panels-item&gt;</span></span><br><span class="line"><span class="string">            &lt;tabs-panels-item&gt;content 2&lt;/tabs-panels-item&gt;</span></span><br><span class="line"><span class="string">        &lt;/tabs-panels&gt;</span></span><br><span class="line"><span class="string">    &lt;/tabs&gt;</span></span><br><span class="line"><span class="string">    `</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>现在有个问题，我怎么知道要选中那个tab呢?用1，2不大好，所以，改为字符串,并且给下面加上<code>name</code></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line">Vue.component(<span class="string">'tabs'</span>,&#123;</span><br><span class="line">    props: [<span class="string">'selectedTab'</span>],</span><br><span class="line">    template: <span class="string">`</span></span><br><span class="line"><span class="string">        &lt;div class='tabs'&gt;</span></span><br><span class="line"><span class="string">            &lt;slot/&gt;  //注意有子元素的话，添加 插槽</span></span><br><span class="line"><span class="string">        &lt;/div&gt;</span></span><br><span class="line"><span class="string">    `</span></span><br><span class="line">&#125;)</span><br><span class="line">Vue.component(<span class="string">'tans-navs'</span>,&#123;</span><br><span class="line">    template: <span class="string">`</span></span><br><span class="line"><span class="string">    &lt;div class='tabs-navs'&gt;</span></span><br><span class="line"><span class="string">        &lt;slot/&gt;</span></span><br><span class="line"><span class="string">    &lt;/div&gt;</span></span><br><span class="line"><span class="string">`</span></span><br><span class="line">&#125;)</span><br><span class="line">Vue.component(<span class="string">'tabs-navs-item'</span>,&#123;</span><br><span class="line">    props: [<span class="string">'name'</span>],</span><br><span class="line">    template: <span class="string">`</span></span><br><span class="line"><span class="string">    &lt;div class='tabs-navs-item'&gt;</span></span><br><span class="line"><span class="string">        &lt;slot/&gt;</span></span><br><span class="line"><span class="string">    &lt;/div&gt;</span></span><br><span class="line"><span class="string">`</span></span><br><span class="line">&#125;)</span><br><span class="line">Vue.component(<span class="string">'tans-panels'</span>,&#123;</span><br><span class="line">    template: <span class="string">`</span></span><br><span class="line"><span class="string">    &lt;div class='tabs-panels'&gt;</span></span><br><span class="line"><span class="string">        &lt;slot/&gt;</span></span><br><span class="line"><span class="string">    &lt;/div&gt;</span></span><br><span class="line"><span class="string">`</span></span><br><span class="line">&#125;)</span><br><span class="line">Vue.component(<span class="string">'tabs-panels-item'</span>,&#123;</span><br><span class="line">    props: [<span class="string">'name'</span>],</span><br><span class="line">    template: <span class="string">`</span></span><br><span class="line"><span class="string">    &lt;div class='tabs-panels-item'&gt;</span></span><br><span class="line"><span class="string">        &lt;slot/&gt;</span></span><br><span class="line"><span class="string">    &lt;/div&gt;</span></span><br><span class="line"><span class="string">`</span></span><br><span class="line">&#125;)</span><br><span class="line"><span class="keyword">var</span> vm = <span class="keyword">new</span> Vue(&#123;</span><br><span class="line">    el: <span class="string">'#app'</span>,</span><br><span class="line">    data() &#123;</span><br><span class="line">        <span class="keyword">return</span> &#123;</span><br><span class="line">            selectedTab: <span class="string">'tab1'</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    template: <span class="string">`</span></span><br><span class="line"><span class="string">    &lt;tabs :selectedTab = 'tab1'&gt;</span></span><br><span class="line"><span class="string">        &lt;tabs-navs&gt;</span></span><br><span class="line"><span class="string">            &lt;tabs-navs-item name = 'tab1' &gt;1&lt;/tabs-navs-item&gt;</span></span><br><span class="line"><span class="string">            &lt;tabs-navs-item name = 'tab2' &gt;2&lt;/tabs-navs-item&gt;</span></span><br><span class="line"><span class="string">        &lt;/tabs-navs&gt;</span></span><br><span class="line"><span class="string">        &lt;tabs-panels&gt;</span></span><br><span class="line"><span class="string">            &lt;tabs-panels-item name = 'tab1'&gt;content 1&lt;/tabs-panels-item&gt;</span></span><br><span class="line"><span class="string">            &lt;tabs-panels-item name = 'tab2'&gt;content 2&lt;/tabs-panels-item&gt;</span></span><br><span class="line"><span class="string">        &lt;/tabs-panels&gt;</span></span><br><span class="line"><span class="string">    &lt;/tabs&gt;</span></span><br><span class="line"><span class="string">    `</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>这样就初见雏形了</p>
</li>
<li><p>下面就是重点了，孙子怎么知道爷爷的 <code>selectedTab</code>的值呢？</p>
<p>答案是通过孙子的爸爸，爸爸获得<code>selectedTab</code>，然后再给孙子，</p>
<p>问题又来了，爸爸怎么从爷爷那里获得呢？</p>
<p><strong>孙子，爸爸自己定义一个属性<code>selectedTab</code>，再写一个<code>methods: SelectedTab(tab)</code>，爷爷遍历所有的爸爸，然后调用爸爸的<code>SelectedTab(tab)</code>把爷爷的<code>selectedTab</code>传给爸爸的<code>selectedTab</code>，同理，爸爸再用同样的方式传给孙子。</strong></p>
<p>P.S 爷爷：<code>tabs</code> ， 爸爸 ： <code>tabs-navs</code> , 孙子: <code>tabs-navs-item</code></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br></pre></td><td class="code"><pre><span class="line">Vue.component(<span class="string">'tabs'</span>, &#123;</span><br><span class="line">    props: [<span class="string">'selectedTab'</span>],</span><br><span class="line">    template: <span class="string">`</span></span><br><span class="line"><span class="string">        &lt;div class='tabs'&gt;</span></span><br><span class="line"><span class="string">            &lt;slot/&gt;</span></span><br><span class="line"><span class="string">        &lt;/div&gt;</span></span><br><span class="line"><span class="string">    `</span>,</span><br><span class="line">    mounted() &#123;</span><br><span class="line">        <span class="keyword">this</span>.$children.forEach(<span class="function">(<span class="params">vm</span>) =&gt;</span> &#123; <span class="comment">//遍历所有的孩子</span></span><br><span class="line">            <span class="keyword">if</span> (vm.$options.name === <span class="string">'tabs-navs'</span>) &#123; <span class="comment">//如果是爸爸</span></span><br><span class="line">                <span class="built_in">console</span>.log(<span class="string">'爷爷的selectedTab是'</span>+<span class="keyword">this</span>.selectedTab)</span><br><span class="line">                vm.SelectedTab(<span class="keyword">this</span>.selectedTab) <span class="comment">//通过爸爸的selectedTab方法，传给儿子</span></span><br><span class="line">            &#125;<span class="keyword">else</span> <span class="keyword">if</span>(vm.$options.name === <span class="string">'tabs-panels'</span>)&#123;</span><br><span class="line">                vm.SelectedTab(<span class="keyword">this</span>.selectedTab)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br><span class="line">Vue.component(<span class="string">'tabs-navs'</span>, &#123;</span><br><span class="line">    data() &#123;</span><br><span class="line">        <span class="keyword">return</span> &#123;</span><br><span class="line">            selectedTab: <span class="literal">undefined</span> <span class="comment">//爸爸自己有一个selectedTab属性       </span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    template: <span class="string">`</span></span><br><span class="line"><span class="string">    &lt;div class='tabs-navs'&gt;</span></span><br><span class="line"><span class="string">        &lt;slot/&gt;</span></span><br><span class="line"><span class="string">    &lt;/div&gt;</span></span><br><span class="line"><span class="string">    `</span>,</span><br><span class="line">    methods: &#123;</span><br><span class="line">        SelectedTab(tab) &#123;</span><br><span class="line">            <span class="keyword">this</span>.selectedTab = tab <span class="comment">//通过这个方法，从爷爷那里获取selectedTab</span></span><br><span class="line">            <span class="built_in">console</span>.log(<span class="string">'爸爸获取到了爷爷的selectedTab是'</span>+<span class="keyword">this</span>.selectedTab)</span><br><span class="line">            <span class="keyword">this</span>.$children.forEach(<span class="function">(<span class="params">vm</span>)=&gt;</span>&#123; <span class="comment">//同样的方法传给孙子</span></span><br><span class="line">                <span class="keyword">if</span>(vm.$options.name === <span class="string">'tabs-navs-item'</span>)&#123;</span><br><span class="line">                    vm.SelectedTab(<span class="keyword">this</span>.selectedTab)</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br><span class="line">Vue.component(<span class="string">'tabs-navs-item'</span>, &#123;</span><br><span class="line">    props: [<span class="string">'name'</span>],</span><br><span class="line">    data () &#123;</span><br><span class="line">        <span class="keyword">return</span> &#123;</span><br><span class="line">            selectedTab:<span class="literal">undefined</span>      </span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    template: <span class="string">`</span></span><br><span class="line"><span class="string">    &lt;div class='tabs-navs-item' :class = '&#123;active&#125;'&gt;   //通过计算属性，判断active</span></span><br><span class="line"><span class="string">        &lt;slot/&gt;</span></span><br><span class="line"><span class="string">    &lt;/div&gt;</span></span><br><span class="line"><span class="string">    `</span>,</span><br><span class="line">    computed: &#123;</span><br><span class="line">        active() &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">this</span>.selectedTab === <span class="keyword">this</span>.name  <span class="comment">//通过计算属性，判断active</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    methods:&#123;</span><br><span class="line">        SelectedTab(tab)&#123;</span><br><span class="line">            <span class="keyword">this</span>.selectedTab = tab</span><br><span class="line">            <span class="built_in">console</span>.log(<span class="string">'儿子获取到了从爸爸的selected是'</span>+<span class="keyword">this</span>.selectedTab)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br><span class="line">Vue.component(<span class="string">'tabs-panels'</span>, &#123;</span><br><span class="line">    data () &#123;</span><br><span class="line">        <span class="keyword">return</span> &#123;</span><br><span class="line">            selectedTab:<span class="literal">undefined</span>       </span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    template: <span class="string">`</span></span><br><span class="line"><span class="string">    &lt;div class='tabs-panels'&gt;</span></span><br><span class="line"><span class="string">        &lt;slot/&gt;</span></span><br><span class="line"><span class="string">    &lt;/div&gt;</span></span><br><span class="line"><span class="string">    `</span>,</span><br><span class="line">    methods:&#123;</span><br><span class="line">        SelectedTab(tab)&#123;</span><br><span class="line">            <span class="keyword">this</span>.selectedTab = tab;</span><br><span class="line">            <span class="keyword">this</span>.$children.forEach(<span class="function">(<span class="params">vm</span>)=&gt;</span>&#123; <span class="comment">//同样的方法传给孙子</span></span><br><span class="line">                <span class="keyword">if</span>(vm.$options.name === <span class="string">'tabs-panels-item'</span>)&#123;</span><br><span class="line">                    vm.SelectedTab(<span class="keyword">this</span>.selectedTab)</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br><span class="line">Vue.component(<span class="string">'tabs-panels-item'</span>, &#123;</span><br><span class="line">    props: [<span class="string">'name'</span>],</span><br><span class="line">    data () &#123;</span><br><span class="line">        <span class="keyword">return</span> &#123;</span><br><span class="line">            selectedTab:<span class="literal">undefined</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    template: <span class="string">`</span></span><br><span class="line"><span class="string">    &lt;div class='tabs-panels-item' :class = '&#123;active&#125;'&gt;</span></span><br><span class="line"><span class="string">        &lt;slot/&gt;</span></span><br><span class="line"><span class="string">    &lt;/div&gt;</span></span><br><span class="line"><span class="string">    `</span>,</span><br><span class="line">    computed:&#123;</span><br><span class="line">        active()&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">this</span>.selectedTab === <span class="keyword">this</span>.name</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    methods:&#123;</span><br><span class="line">        SelectedTab(tab)&#123;</span><br><span class="line">            <span class="keyword">this</span>.selectedTab = tab</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br><span class="line"><span class="keyword">var</span> vm = <span class="keyword">new</span> Vue(&#123;</span><br><span class="line">    el: <span class="string">'#app'</span>,</span><br><span class="line">    data() &#123;</span><br><span class="line">        <span class="keyword">return</span> &#123;</span><br><span class="line">            selectedTab: <span class="string">'tab1'</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    template: <span class="string">`</span></span><br><span class="line"><span class="string">    &lt;tabs :selectedTab = 'tab1'&gt;</span></span><br><span class="line"><span class="string">        &lt;tabs-navs&gt;</span></span><br><span class="line"><span class="string">            &lt;tabs-navs-item name = 'tab1' &gt;1&lt;/tabs-navs-item&gt;</span></span><br><span class="line"><span class="string">            &lt;tabs-navs-item name = 'tab2' &gt;2&lt;/tabs-navs-item&gt;</span></span><br><span class="line"><span class="string">        &lt;/tabs-navs&gt;</span></span><br><span class="line"><span class="string">        &lt;tabs-panels&gt;</span></span><br><span class="line"><span class="string">            &lt;tabs-panels-item name = 'tab1'&gt;content 1&lt;/tabs-panels-item&gt;</span></span><br><span class="line"><span class="string">            &lt;tabs-panels-item name = 'tab2'&gt;content 2&lt;/tabs-panels-item&gt;</span></span><br><span class="line"><span class="string">        &lt;/tabs-panels&gt;</span></span><br><span class="line"><span class="string">    &lt;/tabs&gt;</span></span><br><span class="line"><span class="string">    `</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>这样，<code>selectedTab</code>  整个传递的线路，我们就打通了。<code>tabs-panels</code>的方法同理</p>
</li>
<li><p>下面也是重点，我点击<code>tabs-navs-item</code>的时候，孙子要告诉爷爷该切换了，但孙子不能直接告诉爷爷，先告诉爸爸，爸爸再告诉爷爷。</p>
<p><strong>注意：Vue没有冒泡，孙子触发的$emit事件，爸爸是不知道的，所以要用爸爸监听$on孙子，爷爷监听$on爸爸，然后爷    爷再把数据传出去update()</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//孙子</span></span><br><span class="line">onClick()&#123;</span><br><span class="line">    <span class="keyword">this</span>.$emit(<span class="string">'update:selectedTab'</span>, <span class="keyword">this</span>.name) </span><br><span class="line">    <span class="comment">//孙子传出去。</span></span><br><span class="line">    <span class="comment">//name = 'tab1'的作用在这里体现，之前的vm.$options.name其实是 component 的 name</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//爸爸</span></span><br><span class="line">mounted() &#123;</span><br><span class="line">        <span class="keyword">this</span>.$children.forEach(<span class="function">(<span class="params">vm</span>) =&gt;</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (vm.$options.name === <span class="string">'tabs-navs-item'</span>) &#123;</span><br><span class="line">                vm.$on(<span class="string">'update:selectedTab'</span>, (e) =&gt; &#123; <span class="comment">//监听儿子的 update：selectedTab</span></span><br><span class="line">                    <span class="built_in">console</span>.log(<span class="string">'爸爸知道了你要更新selectedTab是'</span> + e)</span><br><span class="line">                    <span class="keyword">this</span>.$emit(<span class="string">'update:selectedTab'</span>, e) <span class="comment">//爸爸传给爷爷需要改的数</span></span><br><span class="line">                &#125;)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line"><span class="comment">//爷爷</span></span><br><span class="line">mounted() &#123;</span><br><span class="line">        <span class="keyword">this</span>.$children.forEach(<span class="function">(<span class="params">vm</span>) =&gt;</span> &#123; <span class="comment">//遍历所有的孩子</span></span><br><span class="line">            <span class="keyword">if</span> (vm.$options.name === <span class="string">'tabs-navs'</span>) &#123;</span><br><span class="line">                <span class="built_in">console</span>.log(<span class="string">'爷爷的selectedTab是'</span> + <span class="keyword">this</span>.selectedTab)</span><br><span class="line">                vm.SelectedTab(<span class="keyword">this</span>.selectedTab) <span class="comment">//通过儿子的selectedTab方法，传给儿子</span></span><br><span class="line">                <span class="comment">//爷爷监听爸爸的update，更新selectedTab属性，更新操作在updatde里面做</span></span><br><span class="line">                vm.$on(<span class="string">'update:selectedTab'</span>,(e)=&gt;&#123; </span><br><span class="line">                    <span class="built_in">console</span>.log(<span class="string">'爷爷知道了爸爸给我的selectedTab是'</span> + e)                    </span><br><span class="line">                    <span class="keyword">this</span>.$emit(<span class="string">'update:selectedTab'</span>,e)</span><br><span class="line">                &#125;)</span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="keyword">if</span> (vm.$options.name === <span class="string">'tabs-panels'</span>) &#123;</span><br><span class="line">                vm.SelectedTab(<span class="keyword">this</span>.selectedTab)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;,</span><br><span class="line">updated() &#123;  <span class="comment">//更新selectedTab</span></span><br><span class="line">        <span class="keyword">this</span>.$children.forEach(<span class="function">(<span class="params">vm</span>) =&gt;</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (vm.$options.name === <span class="string">'tabs-navs'</span>) &#123;    </span><br><span class="line">                vm.SelectedTab(<span class="keyword">this</span>.selectedTab)</span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="keyword">if</span> (vm.$options.name === <span class="string">'tabs-panels'</span>) &#123;</span><br><span class="line">                vm.SelectedTab(<span class="keyword">this</span>.selectedTab)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//然后体现在 template 里 ，使用 .sync 修饰符</span></span><br><span class="line"><span class="keyword">var</span> vm = <span class="keyword">new</span> Vue(&#123;</span><br><span class="line">    el: <span class="string">'#app'</span>,</span><br><span class="line">    data() &#123;</span><br><span class="line">        <span class="keyword">return</span> &#123;</span><br><span class="line">            value: <span class="string">'tab1'</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    template: <span class="string">`</span></span><br><span class="line"><span class="string">    &lt;tabs :selectedTab.sync = 'value' &gt;  // 在这里更新</span></span><br><span class="line"><span class="string">        &lt;tabs-navs&gt;</span></span><br><span class="line"><span class="string">            &lt;tabs-navs-item name = 'tab1' &gt;1&lt;/tabs-navs-item&gt;</span></span><br><span class="line"><span class="string">            &lt;tabs-navs-item name = 'tab2' &gt;2&lt;/tabs-navs-item&gt;</span></span><br><span class="line"><span class="string">        &lt;/tabs-navs&gt;</span></span><br><span class="line"><span class="string">        &lt;tabs-panels&gt;</span></span><br><span class="line"><span class="string">            &lt;tabs-panels-item name = 'tab1'&gt;content 1&lt;/tabs-panels-item&gt;</span></span><br><span class="line"><span class="string">            &lt;tabs-panels-item name = 'tab2'&gt;content 2&lt;/tabs-panels-item&gt;</span></span><br><span class="line"><span class="string">        &lt;/tabs-panels&gt;</span></span><br><span class="line"><span class="string">    &lt;/tabs&gt;</span></span><br><span class="line"><span class="string">    `</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
</li>
</ul>

      

      
        
    </div>
  </div>
  
</article>



  
    <article id="post-Http" class="article article-type-post" itemscope="" itemprop="blogPost">
  
  <div class="article-inner">
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/archives/a1ede006.html">HTTP</a>
    </h1>
  

      </header>
    
    <div class="article-meta">
      <a href="/archives/a1ede006.html" class="article-date">
  <time datetime="2018-08-24T09:16:35.000Z" itemprop="datePublished">2018-08-24</time>
</a>
      
    </div>
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="HTTP"><a href="#HTTP" class="headerlink" title="HTTP"></a>HTTP</h2><h3 id="1-HTTP为什么重要"><a href="#1-HTTP为什么重要" class="headerlink" title="1.HTTP为什么重要"></a>1.HTTP为什么重要</h3><ol>
<li>HTTP 是前后端合作的重要方式<br>99%的需求都是通过 HTTP 做到，小部分需求可以通过 WebSockets 做到。</li>
<li>HTTP 能帮你从本质上理解 HTML、CSS、JS、图片、JSON、JSONP 等不同形式的资源</li>
<li>Web 性能优化基本等价于对 HTTP 传输效率优化</li>
<li>前端工程化需要你对 HTTP 缓存有深入了解</li>
</ol>
<h3 id="2-什么是HTTP"><a href="#2-什么是HTTP" class="headerlink" title="2.什么是HTTP"></a>2.什么是HTTP</h3><p>####1.四个概念</p>
<ol>
<li>server</li>
<li>client</li>
<li>request</li>
<li>response</li>
</ol>
<ul>
<li><p>server</p>
<p>服务器端</p>
</li>
<li><p>client</p>
<p>客户端</p>
</li>
</ul>
<h4 id="2-request-请求"><a href="#2-request-请求" class="headerlink" title="2.request 请求"></a>2.request 请求</h4><p>请求包含四个部分</p>
<ol>
<li><p>动词  路径  协议/版本号  — GET ./style.css  HTTP/1.1</p>
</li>
<li><p>一些 key : value ，用回车分割</p>
<p>Host : xxx.xxx.xxx</p>
<p>Connection : keep-alive</p>
<p>Content-Type : application/javascript</p>
<p>User-Agent : xxxxxxxxxxx</p>
<p>Accept : xxxxx</p>
</li>
<li><p>回车，作用：分割第二部分和第三部分</p>
</li>
<li><p>什么都行，但是内容的格式必须要在第二部分的 <code>Content-Type</code>中声明</p>
</li>
</ol>
<h4 id="3-response-响应"><a href="#3-response-响应" class="headerlink" title="3.response 响应"></a>3.response 响应</h4><p>响应也包含四个部分</p>
<ol>
<li>协议/版本号 状态码 状态信息  HTTP/1.1 200 OK</li>
<li>一些 key : value ，用回车分割</li>
<li>回车，作用：分割第二部分和第三部分</li>
<li>什么都行，但是内容的格式必须要在第二部分的 <code>Content-Type</code>中声明</li>
</ol>
<h3 id="3-HTML-CSS-JS-JSON-JSONP都是什么？"><a href="#3-HTML-CSS-JS-JSON-JSONP都是什么？" class="headerlink" title="3.HTML,CSS,JS,JSON,JSONP都是什么？"></a>3.HTML,CSS,JS,JSON,JSONP都是什么？</h3><h4 id="1-HTML，CSS，JS的本质"><a href="#1-HTML，CSS，JS的本质" class="headerlink" title="1.HTML，CSS，JS的本质"></a>1.HTML，CSS，JS的本质</h4><p>本质是字符串，只是 <code>Content-Type</code>不同</p>
<ul>
<li>HTML  Content-Type : text/html</li>
<li>CSS      Content-Type : text/css</li>
<li>JS          Content-Type : application/javascript</li>
</ul>
<p>注意 url 里的后缀是废话，毫无意义。</p>
<ol>
<li>浏览器通过地址栏、iframe 来请求 HTML</li>
<li>浏览器通过 link 标签获取 CSS，然后渲染</li>
<li>浏览器通过 script 标签获取 JS，然后执行</li>
<li>浏览器通过 image 标签获取图片，然后展示</li>
</ol>
<h4 id="2-JSON"><a href="#2-JSON" class="headerlink" title="2.JSON"></a>2.JSON</h4><p>json也是字符串</p>
<p>JSON Content-Type : application/json</p>
<h4 id="3-JSONP"><a href="#3-JSONP" class="headerlink" title="3.JSONP"></a>3.JSONP</h4><p>本质就是字符串，只不过</p>
<ol>
<li>Content-Type 为application/javascript 或者 text/javascript</li>
<li>内容格式为 <code>functionName( {&quot;format&quot;: &quot;JSON&quot;} )</code></li>
</ol>
<h3 id="4-缓存"><a href="#4-缓存" class="headerlink" title="4.缓存"></a>4.缓存</h3><ol>
<li>使用 Cache-Control 缓存是常用的缓存方式</li>
<li>想要更新缓存只需稍微变更一下 url<ol>
<li>app-2131312362387123.js</li>
<li>app.js?v=1</li>
<li>app.js?t=201801012334</li>
<li>不要缓存入口页面，这是你更新资源的唯一入口</li>
</ol>
</li>
</ol>
<p><strong>并不是缓存</strong></p>
<p>Etag 和 304 会避免下载，但是还是会发出请求，并不属于缓存</p>
<h3 id="5-Cookie-和-Session"><a href="#5-Cookie-和-Session" class="headerlink" title="5.Cookie 和 Session"></a>5.Cookie 和 Session</h3><h4 id="1-Cookie"><a href="#1-Cookie" class="headerlink" title="1.Cookie"></a>1.Cookie</h4><p>因为HTTP协议是 <strong>无状态</strong> 的，通俗来说是 <strong>没脑子</strong>，它没有记忆。</p>
<p>假如用户登录成功后，刷新页面，用户的登录状态就没有了，这里可以用 Cookie 解决。</p>
<p><strong>保存登录状态</strong></p>
<p>jack登录a.com发出请求 uername:jack ; password : 123 —-&gt;  </p>
<p>后台接收到数据，账号密码正确，发出响应，响应头<code>header</code>写上<code>&#39;Set-Cookie&#39;,&#39;login = jack&#39;</code>—–&gt;</p>
<p>浏览器收到响应，种上 Cookie  —-&gt;</p>
<p>当jack再次访问a.com的其他页面时候，请求头中会带上<code>Cookie : login=jack</code>——&gt;</p>
<p>jack发现他还是登录状态，非常高兴 : ) —– end</p>
<p><strong>区分用户</strong></p>
<p>frank 这时候也登录 a.com 这时候他获得的 响应头就是<code>&#39;Set-Cookie&#39;,&#39;login = frank&#39;</code>了，这样我们也能区分jack 和 frank 了</p>
<p>但是<code>Cookie</code>有一个很不安全的地方，任何一个前端都可以使用<code>document.cookie = xxx</code>来伪造。</p>
<p><strong>我们需要一个方法既需要能标识用户，又可以防止前端伪造</strong></p>
<h4 id="2-Session"><a href="#2-Session" class="headerlink" title="2.Session"></a>2.Session</h4><p>因为<code>Cookie</code>不安全，所以出现了<code>Session</code>。</p>
<p><code>Session</code>是存在数据库的，因此前端无法修改。</p>
<p><strong>流程</strong></p>
<p>用户输入账户密码登录 ——&gt;  发送请求 ———&gt; 服务器验证账户密码正确———&gt; </p>
<p><strong>分配一个<code>session</code>，通过<code>cookie</code>告诉浏览器</strong>———&gt;<code>Set-Cookie,sessionId = &#39;xxxxxxxxxxxxx&#39;</code></p>
<p>剩下的就是和<code>Cookie</code>一样了。</p>
<h4 id="3-两者不同"><a href="#3-两者不同" class="headerlink" title="3.两者不同"></a>3.两者不同</h4><ol>
<li>使用时间：用Cookie分辨两个不同的用户，用Session存放用户的敏感数据。</li>
<li>实现方式：Cookie使用Set-Cookie实现，Session你想怎么实现就怎么实现。</li>
<li>存放方式：Cookie存放在浏览器里，Session存在服务器端的文件，数据库，内存等等。</li>
<li>两者关系：Session一般基于Cookie，存在里面。但也可以放到 localStorage 里面，放到 URL 里等等</li>
</ol>

      

      
        
    </div>
  </div>
  
</article>



  
    <article id="post-Array" class="article article-type-post" itemscope="" itemprop="blogPost">
  
  <div class="article-inner">
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/archives/b3afd273.html">Array--方法</a>
    </h1>
  

      </header>
    
    <div class="article-meta">
      <a href="/archives/b3afd273.html" class="article-date">
  <time datetime="2018-08-24T09:16:35.000Z" itemprop="datePublished">2018-08-24</time>
</a>
      
    </div>
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="1-Array"><a href="#1-Array" class="headerlink" title="1.Array"></a>1.Array</h2><h4 id="1-join"><a href="#1-join" class="headerlink" title="1.join"></a>1.join</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> array = [<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>]</span><br><span class="line">array.join(<span class="string">'-'</span>) <span class="comment">// 1-2-3</span></span><br></pre></td></tr></table></figure>
<p>猜测一下源码</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">Array</span>.prototype.join = <span class="function"><span class="keyword">function</span>(<span class="params">char</span>)</span>&#123;</span><br><span class="line">  <span class="keyword">let</span> result = <span class="keyword">this</span>[<span class="number">0</span>] || <span class="string">''</span>;</span><br><span class="line">  <span class="keyword">let</span> length = <span class="keyword">this</span>.length;</span><br><span class="line">  <span class="keyword">for</span>( <span class="keyword">let</span> i = <span class="number">1</span> ; i &lt; length ; i++ )&#123;</span><br><span class="line">    result += char + <span class="keyword">this</span>[i]</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> result</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="2-slice"><a href="#2-slice" class="headerlink" title="2.slice"></a>2.slice</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">array.slice(benginIndex,endIndex)</span><br></pre></td></tr></table></figure>
<p>猜测一下源码</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">Array</span>.prototype.slice = <span class="function"><span class="keyword">function</span>(<span class="params"> begin , end </span>)</span>&#123;</span><br><span class="line">  begin = begin || <span class="number">0</span> ;</span><br><span class="line">  end = end || <span class="keyword">this</span>.length;</span><br><span class="line">  <span class="keyword">let</span> result = [];</span><br><span class="line">  <span class="keyword">for</span>(<span class="keyword">let</span> i = begin ; i &lt; end ; i++)&#123;</span><br><span class="line">    result.push(<span class="keyword">this</span>[i])</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> result</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>于是可以使用<code>slice</code>将伪数组转化为数组</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> arraylike = <span class="string">'abcde'</span>;</span><br><span class="line"><span class="built_in">Array</span>.prototype.slice.call(arraylike) <span class="comment">//['a','b','c','d','e']</span></span><br><span class="line"><span class="comment">//或者</span></span><br><span class="line">[].slice.call(....)</span><br></pre></td></tr></table></figure>
<p>ES6新方法 伪数组转化为数组</p>
<p><code>Array.from(arraylike)</code></p>
<p>P.S. 伪数组原型链里面没有 <code>Array.prototype</code>，所以他就没有 <code>join slice</code>等方法</p>
<h4 id="3-sort"><a href="#3-sort" class="headerlink" title="3.sort"></a>3.sort</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> array = [<span class="number">1</span>,<span class="number">3</span>,<span class="number">2</span>]</span><br><span class="line">array.sort() <span class="comment">//[1,2,3]</span></span><br></pre></td></tr></table></figure>
<p>猜测一下源码</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">Array</span>.prototype.sort = <span class="function"><span class="keyword">function</span> (<span class="params">fn</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">let</span> defaultfn = <span class="function">(<span class="params">a,b</span>)=&gt;</span>&#123; <span class="keyword">return</span> a-b &#125;</span><br><span class="line">    fn = fn|| defaultfn</span><br><span class="line">    <span class="keyword">var</span> roundcount = <span class="keyword">this</span>.length; <span class="comment">//比较的轮数</span></span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">let</span> i = <span class="number">0</span> ; i &lt; roundcount ; i++)&#123;</span><br><span class="line">          <span class="keyword">let</span> minIndex = <span class="keyword">this</span>[i]</span><br><span class="line">          <span class="keyword">for</span>( <span class="keyword">let</span> k = <span class="number">0</span> ; k &lt; <span class="keyword">this</span>.length ; k++)&#123;</span><br><span class="line">            <span class="keyword">if</span>(fn.call( <span class="literal">null</span> , <span class="keyword">this</span>[i] , <span class="keyword">this</span>[k]) &lt; <span class="number">0</span> )&#123;  <span class="comment">// 决定了谁大谁小</span></span><br><span class="line">              [ <span class="keyword">this</span>[i] , <span class="keyword">this</span>[k] ] = [ <span class="keyword">this</span>[k] , <span class="keyword">this</span>[i] ] <span class="comment">//es6新语法，交换值</span></span><br><span class="line">            &#125;</span><br><span class="line">          &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  	<span class="keyword">return</span> <span class="keyword">this</span></span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>
<h4 id="4-foreach"><a href="#4-foreach" class="headerlink" title="4.foreach"></a>4.foreach</h4><p>猜测一下源码</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">Array</span>.prototype.foreach = <span class="function"><span class="keyword">function</span>(<span class="params">fn</span>)</span>&#123;</span><br><span class="line">  <span class="keyword">for</span>(<span class="keyword">let</span> i = <span class="number">0</span> ; i &lt; <span class="keyword">this</span>.length ; i++)&#123;</span><br><span class="line">    <span class="keyword">if</span>(i <span class="keyword">in</span> <span class="keyword">this</span>)&#123;</span><br><span class="line">      fn.call(<span class="literal">undefined</span> , <span class="keyword">this</span>[i] , i , <span class="keyword">this</span>) <span class="comment">// 三个参数代表了 item index array</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>for 和 foreach 的区别</p>
<ol>
<li>foreach 没有 break </li>
</ol>
<ol start="2">
<li>forEach 用到了函数，所以每次迭代都会有一个新的函数作用域；for 循环只有一个作用域 (著名前端面试题)</li>
</ol>
</blockquote>
<h4 id="5-map"><a href="#5-map" class="headerlink" title="5.map"></a>5.map</h4><p>猜测一下源码</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">Array</span>.prototype.map = <span class="function"><span class="keyword">function</span>(<span class="params">fn</span>)</span>&#123;</span><br><span class="line">  <span class="keyword">let</span> result = []</span><br><span class="line">  <span class="keyword">for</span>(<span class="keyword">let</span> i = <span class="number">0</span> ; i &lt; <span class="keyword">this</span>.length ; i++)&#123;</span><br><span class="line">    <span class="keyword">if</span>(i <span class="keyword">in</span> <span class="keyword">this</span>)&#123;</span><br><span class="line">      result[i] = fn.call(<span class="literal">undefined</span> , <span class="keyword">this</span>[i] , i , <span class="keyword">this</span>) <span class="comment">// 三个参数代表了 item index array</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> result</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>map 和 foreach 的区别就是 map 有返回值，所以推荐<strong>忘记</strong> <strong>foreach</strong></p>
<h4 id="6-filter"><a href="#6-filter" class="headerlink" title="6.filter"></a>6.filter</h4><p>猜测一下源码</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">Array</span>.prototype.filter = <span class="function"><span class="keyword">function</span>(<span class="params">fn</span>)</span>&#123;</span><br><span class="line">  <span class="keyword">let</span> result = [];</span><br><span class="line">  <span class="keyword">let</span> temp;</span><br><span class="line">  <span class="keyword">for</span>(<span class="keyword">let</span> i = <span class="number">0</span> ; i &lt; <span class="keyword">this</span>.length ; i++)&#123;</span><br><span class="line">    <span class="keyword">if</span>(temp = fn.call(<span class="literal">null</span> , <span class="keyword">this</span>[i] , i , <span class="keyword">this</span>))&#123;  <span class="comment">//如果temp的到的返回值为 true</span></span><br><span class="line">      	result.push(<span class="keyword">this</span>[i])</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> result</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>所以说 filter 就是一个加了条件的 map</strong> </p>
<h4 id="7-reduce"><a href="#7-reduce" class="headerlink" title="7.reduce"></a>7.reduce</h4><p>猜测一下源码</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">Array</span>.prototype.reduce = <span class="function"><span class="keyword">function</span>(<span class="params">fn , init</span>)</span>&#123;  <span class="comment">// 函数 初始值(可以不传)</span></span><br><span class="line">  <span class="keyword">let</span> result = init;</span><br><span class="line">  <span class="keyword">for</span>(<span class="keyword">let</span> i = <span class="number">0</span> ; i &lt; <span class="keyword">this</span>.length ; i++ )&#123;</span><br><span class="line">    <span class="keyword">if</span>(i <span class="keyword">in</span> <span class="keyword">this</span>)&#123;</span><br><span class="line">      result = fn.call(<span class="literal">undefined</span> , result , <span class="keyword">this</span>[i] , i , <span class="keyword">this</span>) </span><br><span class="line">      <span class="comment">// 后四个参数  当前累计值，当前值，序列，该数组</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">this</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> a  = [<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>]</span><br><span class="line">a.reduce( <span class="function">(<span class="params">result,currentValue,currentIndex,array</span>)=&gt;</span>&#123; <span class="keyword">return</span> result + currentValue &#125; , <span class="number">0</span> ) </span><br><span class="line"><span class="comment">//累加 10</span></span><br></pre></td></tr></table></figure>
<p>####8.总结</p>
<p><em>关于 map , filter , reduce之间的关系</em></p>
<p><strong>用reduce实现map</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> array = [<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>];</span><br><span class="line">array.map(<span class="function">(<span class="params">item</span>)=&gt;</span>&#123;<span class="keyword">return</span> item+<span class="number">1</span>&#125;);</span><br><span class="line">array.reduce(<span class="function">(<span class="params">result,item</span>)=&gt;</span>&#123;</span><br><span class="line">	result.push(item+<span class="number">1</span>)</span><br><span class="line">    <span class="keyword">return</span> result ; </span><br><span class="line">&#125;,[])<span class="comment">//result的初始值设置为 []</span></span><br></pre></td></tr></table></figure>
<p><strong>用reduce实现filter</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> array = [<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>]</span><br><span class="line">array.filter(<span class="function">(<span class="params">item</span>)=&gt;</span>&#123;<span class="keyword">return</span> item%<span class="number">2</span> === <span class="number">0</span>&#125;);</span><br><span class="line">array.reduce(<span class="function">(<span class="params">result,item</span>)=&gt;</span>&#123;</span><br><span class="line">  <span class="keyword">if</span>(item%<span class="number">2</span> === <span class="number">0</span>)&#123;</span><br><span class="line">    result.push(item)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> result</span><br><span class="line">&#125;,[])</span><br></pre></td></tr></table></figure>
<p><strong>结论，其实foreach,map,filter都是由reduce实现，reduce是最关键的。</strong></p>
<h2 id="2-underscore-js"><a href="#2-underscore-js" class="headerlink" title="2.underscore.js"></a>2.underscore.js</h2><h4 id="1-underscore是什么"><a href="#1-underscore是什么" class="headerlink" title="1.underscore是什么"></a>1.underscore是什么</h4><p>underscore是一个集合操作的库(数组和对象)</p>

      

      
        
    </div>
  </div>
  
</article>



  
    <article id="post-封装和继承" class="article article-type-post" itemscope="" itemprop="blogPost">
  
  <div class="article-inner">
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/archives/6936d1ca.html">封装和继承</a>
    </h1>
  

      </header>
    
    <div class="article-meta">
      <a href="/archives/6936d1ca.html" class="article-date">
  <time datetime="2018-08-24T09:16:35.000Z" itemprop="datePublished">2018-08-24</time>
</a>
      
    </div>
    <div class="article-entry" itemprop="articleBody">
      
        <h3 id="1-封装和继承"><a href="#1-封装和继承" class="headerlink" title="1.封装和继承"></a>1.封装和继承</h3><p>​    i 封装</p>
<p>​    为了隐藏细节</p>
<p>​    ii 继承</p>
<p>​    为了复用代码</p>
<p>​    iii 多态</p>
<p>​    灵活</p>
<p>####1.1原型链(对象与对象之间的关系)</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> obj1 = &#123;<span class="attr">name</span>:<span class="string">'1'</span>&#125;;</span><br><span class="line"><span class="built_in">window</span>.Object.prototype === obj.__proto__; <span class="comment">//true</span></span><br></pre></td></tr></table></figure>
<p><img src="/imgaes/原型链.png" alt="原型链"></p>
<p>上面的原型链图形象的表示了他们之间的关系，说白了就是大家都共用同一个 “ 仓库” , 所有对象都共用 <strong>Object</strong>的原型，他们各自又有自己的 “ 仓库” </p>
<p><code>arr1.__proto__ === window.Array.prototype</code> 自己的 Array 仓库，里面有 join ,splice 等方法</p>
<p><code>arr1.__proto__.__proto__ === window.Object.prototype</code>  Object的仓库，里面有 toString , valueOf 等方法</p>
<p><strong>Object 是所有对象的最底层的原型。</strong></p>
<h4 id="1-2this-对象与函数之间的关系"><a href="#1-2this-对象与函数之间的关系" class="headerlink" title="1.2this(对象与函数之间的关系)"></a>1.2this(对象与函数之间的关系)</h4><p>函数： 可执行代码组成的一种对象</p>
<p>所有使用 <code>function</code>声明的函数都只有两个参数 this 和 arguments,</p>
<p><strong>一定要记住</strong></p>
<blockquote>
<p><strong>1.参数的值只有传参的时候才能确定</strong></p>
<p><strong>2.this 是call()的第一个参数 </strong></p>
<p><strong>=&gt; this 的值只有在传参的时候才能确定</strong></p>
</blockquote>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> obj = &#123;</span><br><span class="line">	name:<span class="string">'mayun'</span>,</span><br><span class="line">    child:&#123;</span><br><span class="line">      name:<span class="string">'sicong'</span>,</span><br><span class="line">      sayName:<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;<span class="built_in">console</span>.log(<span class="keyword">this</span>.name)&#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">obj.child.sayName() <span class="comment">//sicong this === obj.child  就是函数的 点 前面的所有</span></span><br><span class="line">obj.child.sayName.call(obj) <span class="comment">// mayun 因为 this === obj  obj.name === 'mayun'</span></span><br><span class="line"><span class="comment">//因此我们也可以看出 function()&#123;&#125; 跟这个 sayName 一点关系都没有， sayName 只是存了 function()&#123;&#125; 的地址而已</span></span><br><span class="line"><span class="comment">//更直观点</span></span><br><span class="line">obj.child.sayName.call(&#123;<span class="attr">name</span>:<span class="string">'wtf'</span>&#125;) <span class="comment">//wtf</span></span><br></pre></td></tr></table></figure>
<p>来几个题试试</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">f</span>(<span class="params"></span>)</span>&#123; <span class="built_in">console</span>.log(<span class="keyword">this</span>) &#125; </span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">f</span>(<span class="params"></span>)</span>&#123; <span class="built_in">console</span>.log(<span class="keyword">this</span>) &#125; f()</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">f</span>(<span class="params"></span>)</span>&#123; ‘use strict’ <span class="built_in">console</span>.log(<span class="keyword">this</span>) &#125; f()</span><br><span class="line"><span class="keyword">var</span> obj = &#123;<span class="attr">sayThis</span>:f&#125; ; obj.sayThis()</span><br><span class="line"><span class="keyword">var</span> obj = &#123;<span class="attr">sayThis</span>:f&#125; ; obj.sayThis.call()</span><br><span class="line">button.onclick = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;<span class="built_in">console</span>.log(<span class="keyword">this</span>)&#125;</span><br><span class="line">$(<span class="string">'#test'</span>).on(<span class="string">'click'</span>,<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;<span class="built_in">console</span>.log(<span class="keyword">this</span>)&#125;)</span><br><span class="line">$(<span class="string">'#ul1'</span>).on(<span class="string">'click'</span>,<span class="string">'li'</span>,<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;<span class="built_in">console</span>.log(<span class="keyword">this</span>)&#125;)</span><br><span class="line">varvm = <span class="keyword">new</span> Vue(&#123;<span class="attr">data</span>:<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;<span class="built_in">console</span>.log(<span class="keyword">this</span>)&#125;&#125;)</span><br></pre></td></tr></table></figure>
<p>答案</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1.</span>不确定，因为没有传参啊	</span><br><span class="line"><span class="number">2.</span><span class="built_in">window</span></span><br><span class="line"><span class="number">3.</span><span class="literal">undefined</span>(use strict)</span><br><span class="line"><span class="number">4.</span>obj <span class="comment">// . 前面的</span></span><br><span class="line"><span class="number">5.</span><span class="built_in">window</span>/<span class="literal">undefined</span></span><br><span class="line"><span class="number">6.</span>button <span class="comment">//浏览器保证的，只要点击了，this === button </span></span><br><span class="line"><span class="number">7.</span>$(<span class="string">'#test'</span>) <span class="comment">//JQ文档写的 this指向了当前正在执行事件的元素</span></span><br><span class="line"><span class="number">8.</span>li <span class="comment">//JQ文档 this 代表了与 selector 相匹配的元素</span></span><br><span class="line"><span class="number">9.</span><span class="keyword">new</span> 出来的对象 vm <span class="comment">//文档说的,因为它call了new 出来的东西</span></span><br></pre></td></tr></table></figure>
<h1 id="那么这么蛋疼的this为什么还要用它，我们要用箭头函数！！"><a href="#那么这么蛋疼的this为什么还要用它，我们要用箭头函数！！" class="headerlink" title="那么这么蛋疼的this为什么还要用它，我们要用箭头函数！！"></a>那么这么蛋疼的this为什么还要用它，我们要用箭头函数！！</h1><p>箭头函数自己没有 <code>this</code>和<code>arguments</code></p>
<p>它的 this  是外面的 this </p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> f = <span class="function"><span class="params">()</span>=&gt;</span>&#123;<span class="built_in">console</span>.log(<span class="keyword">this</span>)&#125; f() <span class="comment">//window </span></span><br><span class="line"><span class="keyword">var</span> obj = &#123; <span class="attr">sayThis</span> : <span class="function"><span class="params">()</span>=&gt;</span>&#123;<span class="built_in">console</span>.log(<span class="keyword">this</span>)&#125;&#125; ; obj.sayThis </span><br><span class="line"><span class="comment">// window ( 如果是function 那就是obj了) </span></span><br><span class="line"><span class="comment">//因为obj的this是window，所以里面的也是window, ()=&gt;&#123;&#125; 不接收this，也不修改this,外面是什么，它就是什么</span></span><br></pre></td></tr></table></figure>
<h4 id="1-3-bind是什么"><a href="#1-3-bind是什么" class="headerlink" title="1.3 bind是什么"></a>1.3 bind是什么</h4><p>先看下MDN的定义</p>
<blockquote>
<p><code>bind()</code>方法创建一个新的函数, 当被调用时，将其<code>this</code>关键字设置为提供的值，在调用新函数时，在任何提供之前提供一个给定的参数序列。</p>
</blockquote>
<p>做几个实验</p>
<figure class="highlight javascript"><figcaption><span>//</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">fn1</span>(<span class="params"></span>)</span>&#123; <span class="built_in">console</span>.log(<span class="keyword">this</span>) &#125; <span class="comment">//this是啥？不知道</span></span><br><span class="line">fn1()<span class="comment">// 哦，this 是 window</span></span><br><span class="line">fn1.call(<span class="number">1</span>) <span class="comment">// this又是 Number(1) 了</span></span><br><span class="line"><span class="comment">//我想写一个直接就知道this是什么的函数</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">fn2</span>(<span class="params"></span>)</span>&#123; fn1.call(<span class="number">1</span>) &#125; <span class="comment">//this 肯定是 Number(1) ，我都钦定了,但是这么写有点啰嗦，JS帮我整个方法</span></span><br><span class="line"><span class="keyword">var</span> fn3 = fn1.bind(<span class="number">1</span>) ; fn3()  <span class="comment">// Number(1)</span></span><br></pre></td></tr></table></figure>
<p><strong>上面我们说到了，this 其实只是函数的第一个参数而已，第二个参数是arguments，我能不能也钦定一下子？</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">fn1</span>(<span class="params"></span>)</span>&#123; <span class="built_in">console</span>.log(<span class="keyword">this</span>) ;<span class="built_in">console</span>.log(<span class="built_in">arguments</span>) &#125; </span><br><span class="line">fn1() <span class="comment">// window []</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">fn2</span>(<span class="params"></span>)</span>&#123; fn1.call(<span class="number">1</span>,<span class="string">'a'</span>,<span class="string">'b'</span>,<span class="string">'c'</span>) &#125; </span><br><span class="line">fn2()<span class="comment">// Number(1) ['a','b','c']</span></span><br><span class="line"><span class="comment">//那这样的话，bind是不是也能指定arguments呢？</span></span><br><span class="line"><span class="keyword">var</span> fn3 = fn1.bind(<span class="number">1</span>,<span class="string">'a'</span>,<span class="string">'b'</span>,<span class="string">'c'</span>);</span><br><span class="line">fn3()<span class="comment">// Number(1) ['a','b','c']</span></span><br></pre></td></tr></table></figure>
<p><strong>所以说<code>bind（）</code>就是返回了一个函数，这个函数 call 原来的函数，而call的值你可以自己指定</strong></p>
<h4 id="1-4-new-是什么"><a href="#1-4-new-是什么" class="headerlink" title="1.4 new 是什么"></a>1.4 new 是什么</h4><h5 id="1-4-1-为什么要有-new-，我们的需求"><a href="#1-4-1-为什么要有-new-，我们的需求" class="headerlink" title="1.4.1 为什么要有 new ，我们的需求"></a>1.4.1 为什么要有 new ，我们的需求</h5><p>​    我们想要 批量创建对象 </p>
<h5 id="1-4-2"><a href="#1-4-2" class="headerlink" title="1.4.2"></a>1.4.2</h5><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Solider</span>(<span class="params">name</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">this</span>.ID = i</span><br><span class="line">    <span class="keyword">this</span>.name = name || <span class="string">'no name'</span>;</span><br><span class="line">    <span class="keyword">this</span>.life = <span class="number">42</span></span><br><span class="line">&#125;</span><br><span class="line">Solider.prototype.兵种 = <span class="string">'解放军'</span>;</span><br><span class="line">Solider.prototype.攻击力 = <span class="number">100</span>;</span><br><span class="line">Solider.prototype.攻击 = <span class="function"><span class="keyword">function</span> (<span class="params"></span>)</span>&#123; &#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> soliders = [];</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">var</span> i = <span class="number">0</span> ; i &lt; <span class="number">100</span> ; i++)&#123;</span><br><span class="line">    soliders.push( <span class="keyword">new</span> Solider() )</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">console</span>.log(soliders)</span><br></pre></td></tr></table></figure>
<p>习俗：</p>
<ol>
<li><p>构造函数首字母大学</p>
<pre><code>2. 构造函数可以省略掉 create
3. 如果构造函数没有参数，可以省略括号。
</code></pre></li>
</ol>
<h3 id="面向对象"><a href="#面向对象" class="headerlink" title="面向对象"></a>面向对象</h3><h5 id="继承"><a href="#继承" class="headerlink" title="继承"></a>继承</h5><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//prototype和 __proto__的区别	</span></span><br><span class="line"><span class="comment">//prototype是函数特有的属性 </span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">a</span>(<span class="params"></span>)</span>&#123;&#125;;</span><br><span class="line">a.prototype</span><br><span class="line"><span class="comment">//访问 __proto__需要 a.prototype.__proto__</span></span><br><span class="line"><span class="keyword">var</span> a = <span class="number">1</span>;</span><br><span class="line">a.__proto__ = <span class="built_in">Number</span>&#123;&#125;;</span><br><span class="line">a.prototype = <span class="literal">undefined</span></span><br></pre></td></tr></table></figure>
<p>ES5</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Human</span>(<span class="params">options</span>)</span>&#123;</span><br><span class="line">    <span class="comment">//this = &#123;&#125;</span></span><br><span class="line">    <span class="comment">//this.__proto__ = Human.prototype JS之父的关怀。将这个空对象this的公有属性连上了 Human的公有属性</span></span><br><span class="line">    <span class="keyword">this</span>.name = options.name;</span><br><span class="line">    <span class="keyword">this</span>.肤色 = options.肤色 <span class="comment">//特有属性</span></span><br><span class="line">    <span class="comment">//return this 都是 JS之父的关怀</span></span><br><span class="line">&#125;</span><br><span class="line">Human.prototype.eat = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;&#125;; <span class="comment">//公有属性</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Solider</span>(<span class="params">options,id</span>)</span>&#123;</span><br><span class="line">    Human.call(<span class="keyword">this</span>,options) <span class="comment">//用Solider里的this,放到 Human 里面用，这样Soilder就有了 name 和 say 的特有属性</span></span><br><span class="line">    <span class="keyword">this</span>.id = id;</span><br><span class="line">    <span class="keyword">this</span>.life = <span class="number">42</span>;</span><br><span class="line">&#125;</span><br><span class="line">Solider.prototype.attack = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;&#125;;</span><br><span class="line"><span class="comment">//Solider.prototype.__proto__ = Human.prototype; 生产环境不能用</span></span><br><span class="line"><span class="comment">//但是 new 可以用，看看上面JS之父的关怀，我们换一种写法</span></span><br><span class="line"><span class="comment">//兼容IE</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">fakeHuman</span>(<span class="params"></span>)</span>&#123;&#125;</span><br><span class="line">fakeHuman.prototype = Human.prototype;</span><br><span class="line">Solider.prototype = <span class="keyword">new</span> fakeHuman()</span><br><span class="line"><span class="comment">//Solider.prototype === fakeHuman.prototype === Human.prototype;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//不兼容IE</span></span><br><span class="line">Solider.prototype = <span class="built_in">Object</span>.create(Human.prototype);</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> s = <span class="keyword">new</span> Solider(&#123;<span class="attr">name</span>:<span class="string">'小小'</span>,肤色:<span class="string">'yellow'</span>&#125;,<span class="number">10</span>)</span><br></pre></td></tr></table></figure>
<p>ES6</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Human</span> </span>&#123;</span><br><span class="line">    <span class="keyword">constructor</span>(options) &#123;</span><br><span class="line">        <span class="keyword">this</span>.name = options.name</span><br><span class="line">        <span class="keyword">this</span>.肤色 = options.肤色</span><br><span class="line">    &#125;</span><br><span class="line">    eat() &#123;&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solider</span> <span class="keyword">extends</span> <span class="title">Human</span> </span>&#123;</span><br><span class="line">    <span class="keyword">constructor</span>(options, id) &#123;</span><br><span class="line">        <span class="keyword">super</span>(options)</span><br><span class="line">        <span class="keyword">this</span>.id = id,</span><br><span class="line">            <span class="keyword">this</span>.life = <span class="number">42</span></span><br><span class="line">    &#125;</span><br><span class="line">    attack() &#123;&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> s = <span class="keyword">new</span> Solider(&#123;<span class="attr">name</span>:<span class="string">'小小'</span>,肤色:<span class="string">'yellow'</span>&#125;,<span class="number">10</span>)</span><br></pre></td></tr></table></figure>
<p>作业题1</p>
<p>要求不使用 class，完成如下需求：</p>
<p>写出一个构造函数 Animal<br>输入为一个对象，如 {物种:’xxx’}<br>输出为一个新对象，该对象的共有属性为 {物种:’xxx’,行动: function(){}}，没有自有属性<br>再写出一个构造函数 Human<br>Human 继承 Animal<br>输入为一个对象，如 {name: ‘Frank’, birthday: ‘2000-10-10’}<br>输出为一个新对象，该对象自有的属性有 name 和 birthday，共有的属性有物种、行动和使用工具<br>在写出一个构造函数 Asian<br>Asian 继承 Human<br>输入为一个对象，如 {city: ‘北京’, name: ‘Frank’, birthday: ‘2000-10-10’ }<br>输出为一个新对象，改对象自有的属性有 name city 和 bitrhday，共有的属性有物种、行动和使用工具和肤色<br>既</p>
<p>最后一个新对象是 Asian 构造出来的<br>Asian 继承 Human，Human 继承 Animal<br>注意，不要使用 class 关键字，使用课上讲的原型链</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Animal</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line">Animal.prototype.行动 = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Human</span>(<span class="params">options</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">this</span>.name = options.name;</span><br><span class="line">    <span class="keyword">this</span>.birthday = options.birthday;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Human.prototype = Object.create(Animal.prototype)</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">fake</span>(<span class="params"></span>)</span>&#123;&#125;</span><br><span class="line">fake.prototype = Animal.prototype;</span><br><span class="line">Human.prototype = <span class="keyword">new</span> fake();</span><br><span class="line"><span class="comment">//关键点 此时Human.prototype.constructor指向function Animal()&#123;&#125;</span></span><br><span class="line"><span class="comment">//因此需要改变constructor指向Human</span></span><br><span class="line">Human.prototype.constructor = Human</span><br><span class="line">Human.prototype.物种 = <span class="string">'人类'</span>;</span><br><span class="line">Human.prototype.使用工具 = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> s = <span class="keyword">new</span> Human(&#123;</span><br><span class="line">    name: <span class="string">'Frank'</span>,</span><br><span class="line">    birthday: <span class="string">'2000-10-10'</span></span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Asian</span>(<span class="params">options</span>) </span>&#123;</span><br><span class="line">    <span class="comment">//关键点，将Human的特有属性，放到Asian来</span></span><br><span class="line">    Human.call(<span class="keyword">this</span>, options)</span><br><span class="line">    <span class="keyword">this</span>.city = options.city;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line">Asian.prototype.肤色 = <span class="string">'yellow'</span></span><br><span class="line"><span class="comment">//继承的关键点</span></span><br><span class="line"><span class="comment">// Asian.prototype = Object.create(Human.prototype)</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">fake2</span>(<span class="params"></span>)</span>&#123;&#125;</span><br><span class="line">fake2.prototype = Human.prototype;</span><br><span class="line">Asian.prototype = <span class="keyword">new</span> fake2();</span><br><span class="line"><span class="comment">//修改 constructor 的指向</span></span><br><span class="line">Asian.prototype.constructor = Asian</span><br><span class="line">Asian.prototype.肤色 = <span class="string">'yellow'</span></span><br><span class="line"><span class="keyword">var</span> h = <span class="keyword">new</span> Asian(&#123;</span><br><span class="line">    city: <span class="string">'北京'</span>,</span><br><span class="line">    name: <span class="string">'Frank'</span>,</span><br><span class="line">    birthday: <span class="string">'2000-10-10'</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>作业题2</p>
<p>要求使用 class，完成如下需求：</p>
<p>写出一个构造函数 Animal<br>输入为一个对象，如 {物种:’xxx’}<br>输出为一个新对象，该对象的共有属性为 {行动: function(){}}，自有属性为 {物种:’xxx’}<br>再写出一个构造函数 Human<br>Human 继承 Animal<br>输入为一个对象，如 {name: ‘Frank’, birthday: ‘2000-10-10’}<br>输出为一个新对象，该对象自有的属性有 name、物种和 birthday，共有的属性有行动和使用工具<br>在写出一个构造函数 Asian<br>Asian 继承 Human<br>输入为一个对象，如 {city: ‘北京’, name: ‘Frank’, birthday: ‘2000-10-10’ }<br>输出为一个新对象，改对象自有的属性有 name city 物种 肤色和 bitrhday，共有的属性有行动和使用工具<br>既</p>
<p>最后一个新对象是 Asian 构造出来的<br>Asian 继承 Human，Human 继承 Animal<br>注意，要使用 class 关键字</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Animal</span></span>&#123;</span><br><span class="line">   <span class="keyword">constructor</span>()&#123;</span><br><span class="line"></span><br><span class="line">   &#125;</span><br><span class="line">   行动()&#123;&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Human</span> <span class="keyword">extends</span> <span class="title">Animal</span></span>&#123;</span><br><span class="line">    <span class="keyword">constructor</span>(options)&#123;</span><br><span class="line">        <span class="keyword">super</span>()</span><br><span class="line">        <span class="keyword">this</span>.name = options.name</span><br><span class="line">        <span class="keyword">this</span>.birthday = options.birthday</span><br><span class="line">    &#125;</span><br><span class="line">    使用工具()&#123;&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Asian</span> <span class="keyword">extends</span> <span class="title">Human</span></span>&#123;</span><br><span class="line">    <span class="keyword">constructor</span>(options)&#123;</span><br><span class="line">        <span class="keyword">super</span>(options)</span><br><span class="line">        <span class="keyword">this</span>.city = options.city</span><br><span class="line">        <span class="keyword">this</span>.物种 = <span class="string">'人类'</span></span><br><span class="line">        <span class="keyword">this</span>.肤色 = <span class="string">'黄色'</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> h = <span class="keyword">new</span> Asian(&#123;<span class="attr">city</span>: <span class="string">'北京'</span>, <span class="attr">name</span>: <span class="string">'Frank'</span>, <span class="attr">birthday</span>: <span class="string">'2000-10-10'</span> &#125;)</span><br></pre></td></tr></table></figure>

      

      
        
    </div>
  </div>
  
</article>



  
    <article id="post-异步" class="article article-type-post" itemscope="" itemprop="blogPost">
  
  <div class="article-inner">
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/archives/f6d05227.html">JavaScript中的异步</a>
    </h1>
  

      </header>
    
    <div class="article-meta">
      <a href="/archives/f6d05227.html" class="article-date">
  <time datetime="2018-08-24T09:16:35.000Z" itemprop="datePublished">2018-08-24</time>
</a>
      
    </div>
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="异步—代码烧脑的原因"><a href="#异步—代码烧脑的原因" class="headerlink" title="异步—代码烧脑的原因"></a>异步—代码烧脑的原因</h2><h3 id="1-同步和异步"><a href="#1-同步和异步" class="headerlink" title="1.同步和异步"></a>1.同步和异步</h3><p>同步：等待结果</p>
<p>异步： 不等待结果</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//同步</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">sleep</span>(<span class="params">seconds</span>)</span>&#123;</span><br><span class="line">  <span class="keyword">var</span> a = <span class="keyword">new</span> <span class="built_in">Date</span>();</span><br><span class="line">  <span class="keyword">while</span>(<span class="keyword">new</span> <span class="built_in">Date</span>() - a &lt; seconds * <span class="number">1000</span>)&#123;</span><br><span class="line">    </span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">console</span>.log(<span class="number">1</span>);</span><br><span class="line">sleep(<span class="number">3</span>);</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">'wake up'</span>);</span><br><span class="line"><span class="built_in">console</span>.log(<span class="number">2</span>);</span><br><span class="line"><span class="comment">//运行结果 1 wake up 2</span></span><br><span class="line"><span class="comment">// 同步是需要等待的，但是 JavaScript 没有这一项功能，所以只能让他不停的工作，然后到达3秒钟</span></span><br></pre></td></tr></table></figure>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 异步</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">sleep</span>(<span class="params">seconds,fn</span>)</span>&#123;</span><br><span class="line">  setTimeout(fn,seconds * <span class="number">1000</span>); <span class="comment">// 实际上是在设置闹钟，让浏览器 xx秒 后执行 fn</span></span><br><span class="line">  <span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">console</span>.log(<span class="number">1</span>);</span><br><span class="line">sleep(<span class="number">3</span>,()=&gt;&#123;<span class="built_in">console</span>.log(<span class="string">'wake up '</span>)&#125;);</span><br><span class="line"><span class="built_in">console</span>.log(<span class="number">2</span>)</span><br><span class="line"><span class="comment">//运行结果 1 2 wake up</span></span><br><span class="line"><span class="comment">// 为什么 setTimeout 可以模拟异步？ 因为 setTimeout 方法是浏览器提供并负责执行的，JS告诉浏览器3S以后执行fn,然后它就可以去干下一步事情了。</span></span><br></pre></td></tr></table></figure>
<p>可以看出，使用异步，JS空闲了很多。</p>
<p>但是注意，JS空闲的时间，浏览器的计数器一直在工作。</p>
<h3 id="2-前端经常用到的异步"><a href="#2-前端经常用到的异步" class="headerlink" title="2.前端经常用到的异步"></a>2.前端经常用到的异步</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> w = <span class="built_in">document</span>.getElementsByTagName(<span class="string">'img'</span>)[<span class="number">0</span>].width;</span><br><span class="line"><span class="built_in">console</span>.log(w) <span class="comment">// 0</span></span><br></pre></td></tr></table></figure>
<p>明明有图片，为什么宽度为0呢？</p>
<p>因为图片加载需要时间。</p>
<p><a href="http://jsbin.com/juwaxar/1/edit?html,js,output" rel="external nofollow noopener noreferrer" target="_blank">例子</a></p>
<p>注意把 Network 的缓存禁用，可以看到效果</p>
<h4 id="解决方案"><a href="#解决方案" class="headerlink" title="解决方案"></a>解决方案</h4><p>在图片加载完成后会有一个 <code>onload</code>事件</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> img = <span class="built_in">document</span>.getElementsByTagName(<span class="string">'img'</span>)[<span class="number">0</span>];</span><br><span class="line">img.onload = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(img.width) <span class="comment">//400</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="3-遍历的异步"><a href="#3-遍历的异步" class="headerlink" title="3.遍历的异步"></a>3.遍历的异步</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> li_List =<span class="built_in">document</span>.querySelectorAll(<span class="string">'li'</span>);</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">var</span> i = <span class="number">0</span>;i&lt;li_List.length;i++)&#123;</span><br><span class="line">  li_List[i].onclick = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(i)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//期望值：点击哪一个 li ， 就会出现该 li 的序号</span></span><br><span class="line"><span class="comment">//结果：打印出的结果会全部都是 n+1</span></span><br><span class="line"><span class="comment">//原因：var i= 0，变量声明提升，会导致循环里用的都是一个 i ，i 最后循环结果会变为 n+1 </span></span><br><span class="line"><span class="comment">//解决方法: let i = 0 ,let 在每次循环的时候都会制造一个分身，绑定到该 li_List[i]上</span></span><br><span class="line"><span class="comment">//哪里的异步？ li_List[i].onClick = function()&#123;&#125; JS没有功夫等你触发 onclick 事件，直接进行了下一步 i++</span></span><br></pre></td></tr></table></figure>
<p><a href="http://jsbin.com/juwaxar/3/edit?html,js,output" rel="external nofollow noopener noreferrer" target="_blank">例子</a></p>
<h3 id="4-AJAX中的异步"><a href="#4-AJAX中的异步" class="headerlink" title="4.AJAX中的异步"></a>4.AJAX中的异步</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> requsest = $.ajax(&#123;</span><br><span class="line">  url:<span class="string">'.'</span>,</span><br><span class="line">  <span class="keyword">async</span>:<span class="literal">false</span></span><br><span class="line">&#125;)</span><br><span class="line"><span class="built_in">console</span>.log(request.responseText);</span><br><span class="line"><span class="comment">//同步的ajax ， 在请求过程中，JS会一直等待响应，非常浪费资源</span></span><br><span class="line"></span><br><span class="line">$.ajax(&#123;</span><br><span class="line">  url:<span class="string">'.'</span>,</span><br><span class="line">  <span class="keyword">async</span>:<span class="literal">true</span>,</span><br><span class="line">  success:<span class="function"><span class="keyword">function</span>(<span class="params">res</span>)</span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(res)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">'OK'</span>)</span><br><span class="line"><span class="comment">//结果 ： OK  res</span></span><br><span class="line"><span class="comment">//异步的ajax </span></span><br><span class="line"><span class="comment">// 为什么使用 success 接收请求？ 因为这是异步的，使用 var xx = $.ajax(&#123;&#125;) 是得不到任何数据的，所以我们告诉浏览器，当接收到请求的时候再用 success 处理</span></span><br></pre></td></tr></table></figure>
<h3 id="5-异步拿到结果的形式"><a href="#5-异步拿到结果的形式" class="headerlink" title="5.异步拿到结果的形式"></a>5.异步拿到结果的形式</h3><p>两种方式</p>
<ol>
<li>轮训 ：不推荐 </li>
<li>回调 ：推荐</li>
</ol>
<h4 id="回调的形式"><a href="#回调的形式" class="headerlink" title="回调的形式"></a>回调的形式</h4><p>1.nodejs的 error-first 形式</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">fs.readFile(<span class="string">'./1.txt'</span>,(error,content)=&gt;&#123;</span><br><span class="line">  <span class="keyword">if</span>(error)&#123;</span><br><span class="line">    <span class="comment">//error</span></span><br><span class="line">  &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="comment">//success</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>2.Jquery 的 success-error 形式</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$.ajax(&#123;</span><br><span class="line">  url:<span class="string">''</span>,</span><br><span class="line">  success:<span class="function"><span class="params">()</span>=&gt;</span>&#123;&#125;,</span><br><span class="line">  error:<span class="function"><span class="params">()</span>=&gt;</span>&#123;&#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>3.Jquery的 done/fail/always形式</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$.ajax(&#123;</span><br><span class="line"></span><br><span class="line">url:<span class="string">'xxx'</span></span><br><span class="line"></span><br><span class="line">&#125;) . done( <span class="function"><span class="params">()</span>=&gt;</span>&#123;&#125; ) . fail( <span class="function"><span class="params">()</span>=&gt;</span>&#123;&#125; ).always( <span class="function"><span class="params">()</span>=&gt;</span>&#123;&#125; )</span><br></pre></td></tr></table></figure>
<p>4.Promise 的 then 形式</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">axios(&#123;</span><br><span class="line"></span><br><span class="line">url:<span class="string">'xxxx'</span></span><br><span class="line"></span><br><span class="line">&#125;).then( <span class="function"><span class="params">()</span>=&gt;</span>&#123; success &#125; ,()=&gt;&#123; fail &#125;).then(<span class="function"><span class="params">()</span>=&gt;</span>&#123;&#125;)</span><br></pre></td></tr></table></figure>
<h3 id="6-Promise的错误处理"><a href="#6-Promise的错误处理" class="headerlink" title="6.Promise的错误处理"></a>6.Promise的错误处理</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">axios(&#123;</span><br><span class="line">  url:<span class="string">'.'</span>,</span><br><span class="line">  <span class="keyword">async</span>:<span class="literal">true</span></span><br><span class="line">&#125;).then(<span class="function">(<span class="params">x</span>)=&gt;</span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'succ1'</span>)</span><br><span class="line">  <span class="keyword">return</span> <span class="string">'aaaaa'</span></span><br><span class="line">&#125;,(y)=&gt;&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'err1'</span>)</span><br><span class="line">&#125;).then(<span class="function">(<span class="params">x</span>)=&gt;</span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'succ2'</span>,x) <span class="comment">// succ2 aaaa</span></span><br><span class="line">&#125;,(y)=&gt;&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'err2'</span>)</span><br><span class="line">  <span class="built_in">console</span>.log(y)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>succ1和err1中的代码任意一个有错误，都由err2来处理 , err2的第一个参数可以接受错误值</p>
<p>succ1成功，转入succ2</p>
<p>succ1 return 的值会传入 succ2的参数</p>
<p>手动失败 <code>return Promise.reject(&#39;xxx&#39;)</code></p>
<p>catch可以放在最后搞定之前没写 失败函数的then ，但是 .catch((err)=&gt;{}) ===  .then(undefined,(err)=&gt;{})</p>
<p><a href="http://jsbin.com/nituloc/edit?html,js,console,output" rel="external nofollow noopener noreferrer" target="_blank">例子</a></p>
<h3 id="7-手写一个Promise"><a href="#7-手写一个Promise" class="headerlink" title="7.手写一个Promise"></a>7.手写一个Promise</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">ajax</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resovle,reject</span>)=&gt;</span>&#123;</span><br><span class="line">    	<span class="comment">//做事情</span></span><br><span class="line">    	<span class="comment">// 成功resovle</span></span><br><span class="line">    	<span class="comment">// 失败 reject</span></span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">buy</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">res,rej</span>)=&gt;</span>&#123;</span><br><span class="line">    setTimeout(<span class="function"><span class="params">()</span>=&gt;</span>&#123;</span><br><span class="line">      res(<span class="string">'apple'</span>)</span><br><span class="line">    &#125;,<span class="number">2000</span>)</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br><span class="line">buy().then(<span class="function">(<span class="params">res</span>)=&gt;</span>&#123;<span class="built_in">console</span>.log(res)&#125;,(err)=&gt;&#123;<span class="built_in">console</span>.log(err)&#125;)</span><br></pre></td></tr></table></figure>
<p><a href="http://jsbin.com/logenof/2/edit?html,js,output" rel="external nofollow noopener noreferrer" target="_blank">例子</a></p>
<h3 id="8-async-await"><a href="#8-async-await" class="headerlink" title="8.async/await"></a>8.async/await</h3><p>以同步的方式写异步</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">buy</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">res,rej</span>)=&gt;</span>&#123;</span><br><span class="line">    setTimeout(<span class="function"><span class="params">()</span>=&gt;</span>&#123;</span><br><span class="line">      res(<span class="string">'apple'</span>)</span><br><span class="line">    &#125;,<span class="number">2000</span>)</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> res = <span class="keyword">await</span> buy();</span><br></pre></td></tr></table></figure>

      

      
        
    </div>
  </div>
  
</article>



  
    <article id="post-重构" class="article article-type-post" itemscope="" itemprop="blogPost">
  
  <div class="article-inner">
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/archives/3404a532.html">重构</a>
    </h1>
  

      </header>
    
    <div class="article-meta">
      <a href="/archives/3404a532.html" class="article-date">
  <time datetime="2018-08-24T09:16:35.000Z" itemprop="datePublished">2018-08-24</time>
</a>
      
    </div>
    <div class="article-entry" itemprop="articleBody">
      
        <h3 id="1-代码优化基本原则"><a href="#1-代码优化基本原则" class="headerlink" title="1.代码优化基本原则"></a>1.代码优化基本原则</h3><p>1.易读性优先</p>
<p>2.如果不是性能瓶颈，就不要为了性能改代码</p>
<p>3.复杂性守恒原则：无论你怎么写代码，复杂性都是不会消失的<br>推论：如果逻辑很复杂，那么代码看起来就应该是复杂的。如果逻辑很简单，代码看起来就应该是简单的。</p>
<h3 id="2-命名"><a href="#2-命名" class="headerlink" title="2.命名"></a>2.命名</h3><p><strong>程序员三大难题</strong></p>
<ol>
<li>变量命名</li>
<li>缓存失效</li>
<li>循环边界</li>
</ol>
<p>可见变量命名的重要性。</p>
<p><a href="https://www.google.com/search?q=github+%E5%91%BD%E5%90%8D%E8%A7%84%E8%8C%83" rel="external nofollow noopener noreferrer" target="_blank">网上有很多命名规范</a>，大家可以参考。这里只讲基本原则。</p>
<ol>
<li><p>注意词性</p>
<ul>
<li><p>普通变量/属性用「名词」</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> person = &#123;</span><br><span class="line">    name: <span class="string">'Frank'</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> student = &#123;</span><br><span class="line">    grade: <span class="number">3</span>,</span><br><span class="line">    class: 2</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>bool变量/属性用「形容词」或者「be动词」或者「情态动词」或者「hasX」</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> person = &#123;</span><br><span class="line">    dead: <span class="literal">false</span>, <span class="comment">// 如果是形容词，前面就没必要加 is，比如isDead 就很废话</span></span><br><span class="line">    canSpeak: <span class="literal">true</span>, <span class="comment">//情态动词有 can、should、will、need 等，情态动词后面接动词</span></span><br><span class="line">    isVip: <span class="literal">true</span>, <span class="comment">// be 动词有 is、was 等，后面一般接名词</span></span><br><span class="line">    hasChildren: <span class="literal">true</span>, <span class="comment">// has 加名词</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>普通函数/方法用「动词」开头</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> person = &#123;</span><br><span class="line">    run()&#123;&#125;, <span class="comment">// 不及物动词</span></span><br><span class="line">    drinkWater()&#123;&#125;, <span class="comment">// 及物动词</span></span><br><span class="line">    eat(foo)&#123;&#125;, <span class="comment">// 及物动词加参数（参数是名词）</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>回调、钩子函数用「介词」开头，或用「动词的现在完成时态」</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> person = &#123;</span><br><span class="line">    beforeDie()&#123;&#125;,</span><br><span class="line">    afterDie()&#123;&#125;,</span><br><span class="line">    <span class="comment">// 或者</span></span><br><span class="line">    willDie()&#123;&#125;</span><br><span class="line">    dead()&#123;&#125; <span class="comment">// 这里跟 bool 冲突，你只要不同时暴露 bool dead 和函数 dead 就行，怕冲突就用上面的 afterDie</span></span><br><span class="line">&#125;</span><br><span class="line">button.addEventListener(<span class="string">'click'</span>, onButtonClick)</span><br><span class="line"><span class="keyword">var</span> component = &#123;</span><br><span class="line">    beforeCreate()&#123;&#125;,</span><br><span class="line">    created()&#123;&#125;,</span><br><span class="line">    beforeMount()&#123;&#125;,</span><br><span class="line">    mounted()&#123;&#125;,</span><br><span class="line">    beforeUpdate()&#123;&#125;,</span><br><span class="line">    updated()&#123;&#125;,</span><br><span class="line">    activated()&#123;&#125;,</span><br><span class="line">    deactivated()&#123;&#125;,</span><br><span class="line">    beforeDestroy()&#123;&#125;,</span><br><span class="line">    destroyed()&#123;&#125;,</span><br><span class="line">    errorCaptured()&#123;&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>容易混淆的地方加前缀</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">div1.classList.add(<span class="string">'active'</span>) <span class="comment">// DOM 对象</span></span><br><span class="line">div2.addClass(<span class="string">'active'</span>) <span class="comment">// jQuery 对象</span></span><br><span class="line">不如改成</span><br><span class="line">domDiv1 或 elDiv1.classList.add(<span class="string">'active'</span>)</span><br><span class="line">$div2.addClass(<span class="string">'active'</span>)</span><br></pre></td></tr></table></figure>
</li>
<li><p>属性访问器函数可以用名词</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$div.text() <span class="comment">// 其实是 $div.getText()</span></span><br><span class="line">$div.text(<span class="string">'hi'</span>) <span class="comment">// 其实是 $div.setText('hi')</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li><p>注意一致性</p>
<ul>
<li><p>介词一致性<br>如果你使用了 before + after，那么就在代码的所有地方都坚持使用<br>如果你使用了 before + 完成时，那么就坚持使用<br>如果你改来改去，就「不一致」了，不一致将导致「不可预测」</p>
</li>
<li><p>顺序一致性<br>比如 updateContainerWidth 和 updateHeightOfContainer 的顺序就令人很别扭，同样会引发「不可预测」</p>
</li>
<li><p>表里一致性<br>函数名必须完美体现函数的功能，既不能多也不能少。<br>比如</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getSongs</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> $.get(<span class="string">'/songs).then((response)&#123;</span></span><br><span class="line"><span class="string">        div.innerText = response.songs</span></span><br><span class="line"><span class="string">    &#125;)</span></span><br><span class="line"><span class="string">&#125;</span></span><br></pre></td></tr></table></figure>
<p>就违背了表里一致性，getSongs 表示获取歌曲，并没有暗示这个函数会更新页面，但是实际上函数更新了 div，这就是表里不一，正确的写法是</p>
<ul>
<li><p>要么纠正函数名</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getSongsAndUpdateDiv</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> $.get(<span class="string">'/songs).then((response)&#123;</span></span><br><span class="line"><span class="string">        div.innerText = response.songs</span></span><br><span class="line"><span class="string">    &#125;)</span></span><br><span class="line"><span class="string">&#125;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>要么写成两个函数</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getSongs</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> $.get(<span class="string">'/songs)</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string">function updateDiv(songs)&#123;</span></span><br><span class="line"><span class="string">    div.innerText = response.songs</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string">getSongs().then((response)=&gt;&#123;</span></span><br><span class="line"><span class="string">    updateDiv(response.songs)</span></span><br><span class="line"><span class="string">&#125;)</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li><p>时间一致性<br>有可能随着代码的变迁，一个变量的含义已经不同于它一开始的含义了，这个时候你需要及时改掉这个变量的名字。<br>这一条是最难做到的，因为写代码容易，改代码难。如果这个代码组织得不好，很可能会出现牵一发而动全身的情况（如全局变量就很难改）</p>
</li>
</ul>
</li>
</ol>
<h2 id="改代码"><a href="#改代码" class="headerlink" title="改代码"></a>改代码</h2><p>如果你的代码有单元测试，那么改起来就很放心。如果没有单元测试，就需要用「小步快跑」的策略来修改。</p>
<p>小步快跑的意思是说，每次只修改一点点，测试通过后，再修改一点点，再测试，再修改一点点……如此反复。</p>
<p>那么如何修改一点点呢？《重构》这本书介绍了很多方法，但是讲得挺啰嗦的，如果你有时间可以看看。</p>
<p>我这里只说两个经久不衰的方法。</p>
<h3 id="一、使用函数来改代码"><a href="#一、使用函数来改代码" class="headerlink" title="一、使用函数来改代码"></a>一、使用函数来改代码</h3><p>步骤：</p>
<ol>
<li>将一坨代码放到一个函数里</li>
<li>将代码依赖的外部变量作为参数</li>
<li>将代码的输出作为函数的返回值</li>
<li>给函数取一个合适的名字</li>
<li>调用这个函数并传入参数</li>
<li>这个函数里的代码如果超过 5 行，则依然有优化的空间，请回到第 1 步</li>
</ol>
<h3 id="二、使用对象来改代码"><a href="#二、使用对象来改代码" class="headerlink" title="二、使用对象来改代码"></a>二、使用对象来改代码</h3><p>如果使用了函数改造法改造后，发现有太多的小函数，则可以使用对象讲这个函数串起来。</p>
<p>记得我们讲过「this 是函数和对象的桥梁」吗，我们会用 this 来串联这个对象和所有函数。</p>
<p>最终代码：<a href="http://js.jirengu.com/mimazaboke/1/edit?html,js,output" rel="external nofollow noopener noreferrer" target="_blank">http://js.jirengu.com/mimazaboke/1/edit?html,js,output</a></p>
<h3 id="一些固定的套路"><a href="#一些固定的套路" class="headerlink" title="一些固定的套路"></a>一些固定的套路</h3><ol>
<li><p>表驱动编程（《代码大全》里说的）<br>所有一一对应的关系都可以用表来做</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//传入分数，返回等级</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">calculateGrade</span>(<span class="params">score</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(score&gt;=<span class="number">90</span>)&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">'A'</span></span><br><span class="line">    &#125;<span class="keyword">else</span> <span class="keyword">if</span>(score&gt;=<span class="number">80</span>)&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">'B'</span></span><br><span class="line">    &#125;<span class="keyword">else</span> <span class="keyword">if</span>(score&gt;=<span class="number">70</span>)&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">'C'</span></span><br><span class="line">    &#125;<span class="keyword">else</span> <span class="keyword">if</span>(score&gt;=<span class="number">60</span>)&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">'D'</span></span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">'E'</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//表驱动编程</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">calculateGrade</span>(<span class="params">score</span>) </span>&#123;  </span><br><span class="line">    <span class="keyword">var</span> table = &#123;</span><br><span class="line">        <span class="number">10</span> : <span class="string">'A'</span>,</span><br><span class="line">        <span class="number">9</span> : <span class="string">'A'</span>,</span><br><span class="line">        <span class="number">8</span> : <span class="string">'B'</span>,</span><br><span class="line">        <span class="number">7</span> : <span class="string">'C'</span>,</span><br><span class="line">        <span class="number">6</span> : <span class="string">'D'</span>,</span><br><span class="line">        others : <span class="string">'E'</span>,</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> level = <span class="built_in">parseInt</span>(score/<span class="number">10</span> , <span class="number">10</span>)</span><br><span class="line">    <span class="keyword">return</span> table[level] || table[<span class="string">'others'</span>] </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//同样也是表驱动编程</span></span><br><span class="line"><span class="comment">//提供数据，提供对应关系，然后我在通过一些方法，一些循环搞定，不需要每个都写函数、</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">pre</span>(<span class="params"></span>)</span>&#123;&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">next</span>(<span class="params"></span>)</span>&#123;&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">cleartimer</span>(<span class="params"></span>)</span>&#123;&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">resettimer</span>(<span class="params"></span>)</span>&#123;&#125; <span class="comment">//四个事件需要绑定到几个元素上</span></span><br><span class="line"><span class="keyword">var</span> events = [</span><br><span class="line">  &#123;<span class="attr">el</span>:<span class="string">'.prebtn'</span>,<span class="attr">event</span>:<span class="string">'click'</span>,<span class="attr">fn</span>:pre&#125;,</span><br><span class="line">  &#123;<span class="attr">el</span>:<span class="string">'.nextbtn'</span>,<span class="attr">event</span>:<span class="string">'click'</span>,<span class="attr">fn</span>:next&#125;,</span><br><span class="line">  &#123;<span class="attr">el</span>:<span class="string">'.timer'</span>,<span class="attr">event</span>:<span class="string">'mouseenter'</span>,<span class="attr">fn</span>:cleartimer&#125;,</span><br><span class="line">  &#123;<span class="attr">el</span>:<span class="string">'.timer'</span>,<span class="attr">event</span>:<span class="string">'mouseleave'</span>,<span class="attr">fn</span>:resettimer&#125;,</span><br><span class="line">];</span><br><span class="line">events.forEach(<span class="function">(<span class="params">eventobject</span>)=&gt;</span>&#123;</span><br><span class="line">  $(eventobject.el).on(eventobject.event,eventobject.fn)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>​</p>
</li>
<li><p>自说明代码（以 API 参数为例）<br>把别人关心的东西放在显眼的位置</p>
</li>
</ol>
<h2 id="bad-smell（坏味道）"><a href="#bad-smell（坏味道）" class="headerlink" title="bad smell（坏味道）"></a>bad smell（坏味道）</h2><p>有些代码可以用，但是很「臭」。</p>
<p>哪些代码是有坏味道的</p>
<ol>
<li>表里不一的代码</li>
<li>过时的注释</li>
<li>逻辑很简单，但是看起来很复杂的代码</li>
<li>重复的代码</li>
<li>相似的代码</li>
<li>总是一起出现的代码</li>
</ol>
<h2 id="破窗效应"><a href="#破窗效应" class="headerlink" title="破窗效应"></a>破窗效应</h2><blockquote>
<p>此理论认为环境中的不良现象如果被放任存在，会诱使人们仿效，甚至变本加厉。一幢有少许破窗的建筑为例，如果那些窗不被修理好，可能将会有破坏者破坏更多的窗户。最终他们甚至会闯入建筑内，如果发现无人居住，也许就在那里定居或者纵火。一面墙，如果出现一些涂鸦没有被清洗掉，很快的，墙上就布满了乱七八糟、不堪入目的东西；一条人行道有些许纸屑，不久后就会有更多垃圾，最终人们会视若理所当然地将垃圾顺手丢弃在地上。这个现象，就是犯罪心理学中的破窗效应。</p>
</blockquote>
<p>程序员要做到：只要是经过你手的代码，都会比之前好一点。</p>

      

      
        
    </div>
  </div>
  
</article>



  
  
    <nav id="page-nav">
      <a class="extend prev" rel="prev" href="/">&laquo; Prev</a><a class="page-number" href="/">1</a><span class="page-number current">2</span><a class="page-number" href="/page/3/">3</a><a class="page-number" href="/page/4/">4</a><a class="extend next" rel="next" href="/page/3/">Next &raquo;</a>
    </nav>
  
</section>
        <aside id="sidebar">
  <nav class="menus">
  	<ul>
  		<li><a href="/"><i class="icon icon-home"></i></a></li>
  		
			<li><a href="/archives"><i class="icon icon-fenlei"></i></a></li>
  		
  		
			<li><a href="/tags"><i class="icon icon-tag"></i></a></li>
  		
  		
  			<li><a href="https://github.com/hejianxian" target="_blank" rel="external nofollow noopener noreferrer"><i class="icon icon-github"></i></a></li>
  		
  	</ul>
  </nav>
  <a id="go-top" href="#"><i class="icon icon-up"></i></a>
</aside>

      </div>
      <footer id="footer">
  
	<div id="footer-info" class="inner">
	  &copy; 2019 Storm 
	  - Powered by <a href="http://hexo.io/" target="_blank" rel="external nofollow noopener noreferrer">Hexo</a>
	  - Theme <a href="https://github.com/hejianxian/hexo-theme-jane/" target="_blank" rel="external nofollow noopener noreferrer">Jane</a>
	</div>
</footer>

    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
    <a href="/tags" class="mobile-nav-link">Tag</a>
  
    <a href="https://github.com/hejianxian" class="mobile-nav-link" rel="external nofollow noopener noreferrer" target="_blank">Github</a>
  
</nav>
    
<script>
  var disqus_shortname = 'storm';
  
  (function(){
    var dsq = document.createElement('script');
    dsq.type = 'text/javascript';
    dsq.async = true;
    dsq.src = '//' + disqus_shortname + '.disqus.com/count.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
  })();
</script>


<script src="//cdn.bootcss.com/jquery/2.0.3/jquery.min.js"></script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  <script src="/fancybox/jquery.fancybox.pack.js"></script>


<script src="/js/script.js"></script>

  </div>
</body>
